<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Code Security Advent Calendar 2020 Answers</title>
  <meta name="description" content="SonarSource is a company focused on code quality and static analysis. This year, SonarSource, along with RIPS Technologies will be tweeting code challenges f...">
  
  <meta name="author" content="Sam Sanoop">
  <meta name="copyright" content="&copy; Sam Sanoop 2022">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <!--<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/.min.css"> -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  <
  
  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="SonarSource is a company focused on code quality and static analysis. This year, SonarSource, along with RIPS Technologies will be tweeting code challenges f..." />
  <meta property="og:url" content="http://localhost:4000/web-application-security/2020/12/28/code-security-advent-calendar-answers.html">
  <meta property="og:site_name" content="üíª | Blog" />
  <meta property="og:title" content="Code Security Advent Calendar 2020 Answers" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://localhost:4000/assets/logo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Code Security Advent Calendar 2020 Answers">
  <meta name="twitter:description" content="SonarSource is a company focused on code quality and static analysis. This year, SonarSource, along with RIPS Technologies will be tweeting code challenges f...">
  <meta name="twitter:image" content="http://localhost:4000/assets/logo.png">
  <meta name="twitter:url" content="http://localhost:4000/web-application-security/2020/12/28/code-security-advent-calendar-answers.html">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/web-application-security/2020/12/28/code-security-advent-calendar-answers.html">
	<link rel="alternate" type="application/rss+xml" title="üíª | Blog" href="http://localhost:4000/feed.xml" />
	
	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="üíª | Blog">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	
	<li class="nav-link"><a href="/wallofsheep/">Wall Of Sheep</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container " >
  <div class="scrim ">
    <header class="post-header">
      <h1 class="title">Code Security Advent Calendar 2020 Answers</h1>
      <p class="info">by <strong>snoopysecurity</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">

 <span class="page-divider">
  <span class="one"></span>
  <span class="two"></span>
</span>
 

<section class="post-meta">
  <div class="post-date">December 28, 2020</div>
  <div class="post-categories">
  in 
    
    <a href="/category/web-application-security">Web-application-security</a>
    
  
  </div>
</section>

<article class="post-content">
  <p>SonarSource is a company focused on code quality and static analysis. This year, SonarSource, along with RIPS Technologies will be tweeting code challenges from real world vulnerabilities on their twitter @SonarSource.More information regarding this can be seen here: https://blog.sonarsource.com/code-security-advent-calendar-2020/.</p>

<p>This blog post will go through some of the solutions. Note: this might be wrong from the intended solution given by SonarSource</p>

<h3 id="challenge-1"><a href="https://twitter.com/SonarSource/status/1333803048599121921">Challenge 1</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">from</span> <span class="n">django</span><span class="p">.</span><span class="n">contrib</span> <span class="n">import</span> <span class="n">auth</span><span class="p">,</span> <span class="n">messages</span>
<span class="k">from</span> <span class="n">django</span><span class="p">.</span><span class="n">http</span> <span class="n">import</span> <span class="n">HttpResponseRedirect</span>
<span class="k">from</span> <span class="n">django</span><span class="p">.</span><span class="n">shortcuts</span> <span class="n">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>
<span class="k">from</span> <span class="n">django</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">translation</span> <span class="n">import</span> <span class="n">ugettext</span> <span class="k">as</span> <span class="n">_</span>
<span class="k">from</span> <span class="n">django</span><span class="p">.</span><span class="n">views</span><span class="p">.</span><span class="n">generic</span> <span class="n">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">FormView</span><span class="p">,</span> <span class="n">RedirectView</span>


<span class="n">class</span> <span class="n">RegisterView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="k">model</span> <span class="p">=</span> <span class="n">User</span>
    <span class="n">form_class</span> <span class="p">=</span> <span class="n">RegistrationForm</span>
    <span class="n">template_name</span> <span class="p">=</span> <span class="s2">"register.html"</span>
    <span class="n">success_url</span> <span class="p">=</span> <span class="s2">"/"</span>
    <span class="n">def</span> <span class="n">post</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="p">*</span><span class="n">args</span><span class="p">,</span> <span class="p">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">form</span> <span class="p">=</span> <span class="n">self</span><span class="p">.</span><span class="n">form_class</span><span class="p">(</span><span class="n">data</span><span class="p">=</span><span class="n">request</span><span class="p">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="p">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="p">=</span> <span class="n">form</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="p">=</span><span class="nb">False</span><span class="p">)</span>
            <span class="n">password</span> <span class="p">=</span> <span class="n">form</span><span class="p">.</span><span class="n">cleaned_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"password1"</span><span class="p">)</span>
            <span class="n">user</span><span class="p">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
            <span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">"login"</span><span class="p">)</span>
        
        
    <span class="n">def</span> <span class="n">dispatch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="p">*</span><span class="n">args</span><span class="p">,</span> <span class="p">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">is_authenticated</span><span class="p">:</span>
            <span class="n">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">get_success_url</span><span class="p">())</span>
        <span class="n">return</span> <span class="n">super</span><span class="p">().</span><span class="n">dispatch</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">request</span><span class="p">,</span> <span class="p">*</span><span class="n">args</span><span class="p">,</span> <span class="p">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">def</span> <span class="n">get_success_url</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">"next"</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">GET</span> <span class="k">and</span> <span class="n">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">GET</span><span class="p">[</span><span class="s2">"next"</span><span class="p">]</span> <span class="c1">!= "":
</span>            <span class="n">return</span> <span class="n">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">GET</span><span class="p">[</span><span class="s2">"next"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return</span> <span class="n">self</span><span class="p">.</span><span class="n">success_url</span>
            
            
    <span class="n">def</span> <span class="n">get_form_class</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">return</span> <span class="n">self</span><span class="p">.</span><span class="n">form_class</span>
</code></pre></div></div>

<p>The issue here arises from the get_success_url function and an Open Redirect vulnerability.. This function checks for a parameter called next and makes a redirect to this parameter value. As such it is possible to djangoapplication?next=//attackersite.url. This redirect will happen after self.request.user.is_authenticated is successful.</p>

<h3 id="challenge-2"><a href="https://twitter.com/SonarSource/status/1334165427719725058">Challenge 2</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">restservice</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">InputStream</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="n">HttpURLConnection</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="n">URL</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">concurrent</span><span class="p">.</span><span class="n">atomic</span><span class="p">.</span><span class="n">AtomicLong</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">Logger</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.*;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">commons</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOUtils</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">entity</span><span class="p">.</span><span class="n">StringEntity</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">entity</span><span class="p">.</span><span class="n">ContentType</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">methods</span><span class="p">.</span><span class="n">HttpPost</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">CloseableHttpClient</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">HttpClients</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">methods</span><span class="p">.</span><span class="n">CloseableHttpResponse</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">EntityUtils</span><span class="p">;</span>
<span class="p">@</span><span class="n">RestController</span>
<span class="k">public</span> <span class="n">class</span> <span class="n">RequestController</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">static</span> <span class="n">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">null</span><span class="p">;</span>
    <span class="n">private</span> <span class="n">final</span> <span class="n">AtomicLong</span> <span class="k">counter</span> <span class="p">=</span> <span class="n">new</span> <span class="n">AtomicLong</span><span class="p">();</span>
    <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="p">{</span><span class="s2">"/api/adapter/{adapter}/activate/{b}"</span><span class="p">},</span> 
            <span class="n">method</span> <span class="p">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">produces</span> <span class="p">=</span> <span class="s2">"application/json"</span><span class="p">)</span>
    <span class="k">public</span> <span class="k">String</span> <span class="n">activateAdapter</span><span class="p">(</span>
            <span class="p">@</span><span class="n">PathVariable</span><span class="p">(</span><span class="s2">"adapter"</span><span class="p">)</span> <span class="k">String</span> <span class="n">connName</span><span class="p">,</span> 
            <span class="p">@</span><span class="n">PathVariable</span><span class="p">(</span><span class="s2">"b"</span><span class="p">)</span> <span class="k">Integer</span> <span class="n">b</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"activating adapter."</span><span class="p">);</span>
        <span class="n">HttpPost</span> <span class="n">post</span> <span class="p">=</span> <span class="n">new</span> <span class="n">HttpPost</span><span class="p">(</span><span class="s2">"https://"</span> <span class="p">+</span> <span class="n">connName</span> <span class="p">+</span> <span class="s2">"/v1/boot"</span><span class="p">);</span>
        <span class="k">String</span> <span class="n">requestBody</span> <span class="p">=</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">activate</span><span class="se">\"</span><span class="s2">:"</span> <span class="p">+</span> <span class="k">Integer</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">+</span> <span class="s2">"}"</span><span class="p">;</span>
        <span class="n">StringEntity</span> <span class="n">requestEntity</span> <span class="p">=</span> <span class="n">new</span> <span class="n">StringEntity</span><span class="p">(</span>
            <span class="n">requestBody</span><span class="p">,</span> 
            <span class="n">ContentType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span>
        <span class="p">);</span>
        <span class="n">post</span><span class="p">.</span><span class="n">setEntity</span><span class="p">(</span><span class="n">requestEntity</span><span class="p">);</span>
        <span class="n">try</span> <span class="p">(</span><span class="n">CloseableHttpClient</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="n">HttpClients</span><span class="p">.</span><span class="n">createDefault</span><span class="p">();</span>
             <span class="n">CloseableHttpResponse</span> <span class="n">response</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">post</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"response:"</span> <span class="p">+</span> <span class="n">response</span><span class="p">.</span><span class="n">getEntity</span><span class="p">());</span>
            <span class="n">return</span> <span class="n">EntityUtils</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">getEntity</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>The issue here arises from the adapter parameter coming from user input. This is given as part of the HttpPost constructor and a new object called postis made which has ‚Äúhttps://‚Äù + connName + ‚Äú/v1/boot‚Äù. This is then given to the httpClient.execute method which will make a request to the crafted url and return the response. This can be abused for an Server Side Request Forgery (SSRF) attack</p>

<h3 id="challenge-3"><a href="https://twitter.com/SonarSource/status/1334527819402145792">Challenge 3</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="kn">use</span> <span class="nn">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="kd">class</span> <span class="nc">LoginController</span> <span class="k">extends</span> <span class="nx">AbstractController</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">DOMDocument</span> <span class="nv">$doc</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$authFile</span> <span class="o">=</span> <span class="s1">'employees.xml'</span><span class="p">;</span>
    
    <span class="k">private</span> <span class="k">function</span> <span class="nf">auth</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doc</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authFile</span><span class="p">);</span>
        <span class="nv">$xpath</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMXPath</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doc</span><span class="p">);</span>
        <span class="nv">$filter</span> <span class="o">=</span> <span class="s2">"[loginID=</span><span class="nv">$userId</span><span class="s2"> and passwd='</span><span class="nv">$passwd</span><span class="s2">'][position()&lt;=1]"</span><span class="p">;</span>
        <span class="nv">$employee</span> <span class="o">=</span> <span class="nv">$xpath</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"/employees/employee</span><span class="nv">$filter</span><span class="s2">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$userId</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'userId'</span><span class="p">);</span>
        <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'password'</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">auth</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$password</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s2">"Wrong </span><span class="nv">$userId</span><span class="s2">."</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loginCompleted</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadUserInformation</span><span class="p">(</span><span class="nv">$employee</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s2">"Login Failed."</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s2">"Login Succeeded."</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The vulnerability here is an XPath Injection. Within function auth, the $userId and $passwd parameter is used to create an XPath query without any sanitization/validation: loginID=$userId and passwd=‚Äô$passwd‚ÄôThis query is used to check if the provided userid and password exists within employees.xml. This check is within the line return ($employee-&gt;length == 0) ? false : true;. This could be abused by a user and bypass this check by injecting something like ‚Äò OR ‚Äò6‚Äô=‚Äô6 .</p>

<h3 id="challenge-4"><a href="https://twitter.com/SonarSource/status/1334890204843347969">Challenge 4</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using System.IO;
using System.Net;
using System.Net.Http;
using Microsoft.AspNetCore.Mvc;
namespace core_api.Controllers
{
    public class DataDownloadController : Controller {
        public readonly string AvatarFolder = "images/avatars/";
        [HttpGet]
        public HttpResponseMessage GetAvatar(string image) {
            if (string.IsNullOrWhiteSpace(image) || image.Contains("/")) {
                return new HttpResponseMessage(HttpStatusCode.BadRequest) {
                    Content =  new StringContent("Valid avatar required")};    
            }
            string img = System.IO.Path.Combine(AvatarFolder, image);
            if (!img.Contains(AvatarFolder) || !System.IO.File.Exists(img)) { 
                return new HttpResponseMessage(HttpStatusCode.NotFound) {
                    Content =  new StringContent("Avatar not found")};
            }
            var fileInfo = new System.IO.FileInfo(img);
            var type = fileInfo.Extension;
            var c = new StreamContent(fileInfo.OpenRead());
            c.Headers.ContentType = new System.Net.Http.Headers.
                MediaTypeHeaderValue("image/" + type);
            return new HttpResponseMessage(HttpStatusCode.OK){Content = c};
        }
    }
}
</code></pre></div></div>

<p>In the above C# code, the source where tainted data is coming from the HttpGet method. This is then given to the GetAvatar as an argument. This function checks if the user value contains a / character and if it does, an error is returned to the user. If this check is not triggered, then the user provided value is combined with images/avatar path using the System.IO.Path.Combine method. A new constructor is created with the System.IO.FileInfo class which provides methods for creation, copying, deletion, moving, and opening of files. The File.OpenRead method is used to fetch the file in this path. On windows systems, the ..\ pattern or ../ pattern can be used to traverse directories. As such, the above code is vulnerable to Path Traversal.</p>

<h3 id="challenge-5"><a href="https://twitter.com/SonarSource/status/1335252597993689088">Challenge 5</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.contrib import messages
from django.shortcuts import render, redirect
from django.contrib.sites.shortcuts import get_current_site
from django.template.loader import render_to_string
from django.utils.http import urlsafe_base64_encode, urlsafe_base64_decode
from django.utils.encoding import force_bytes, force_text
from django.views.decorators.http import require_http_methods
from hashlib import sha1
from project.decorators import check_recaptcha
from project.forms import UserSignUpForm
from project.settings import config
from sendgrid import SendGridAPIClient
from sendgrid.helpers.mail import Mail
from django.contrib.auth import get_user_model
User = get_user_model()
@check_recaptcha
@require_http_methods(["POST"])
def register(request):
    form = UserSignUpForm(request.POST)
    if form.is_valid() and request.recaptcha_is_valid:
        user = form.save(commit=False)
        user.is_active = False
        user.save()
        message = render_to_string('mail/activate.html', {
            'user': user,
            'uid': urlsafe_base64_encode(force_bytes(user.pk)),
            'token': sha1(force_bytes(user.pk)).hexdigest(),
        })
        message = Mail(
            from_email='noreply@' + get_current_site(request).domain,
            to_emails=request.POST.get('email'),
            subject='Your account activation email',
            html_content=message)
        response = SendGridAPIClient(config['SG_API_KEY']).send(message)
        messages.add_message(request, messages.SUCCESS, 'Verification email sent.')
    else:
        return render(request, 'account/register.html', {'form': form})
    return render(request, 'account/register.html', {'form': UserSignUpForm()})
</code></pre></div></div>

<p>In the above code, the SHA1 hashing algorithm is used without a salt to generate a token.: sha1(force_bytes(user.pk)).hexdigest(). As such, an attacker could generate a list of SHA1 hashes and try and brute force the password reset email token of a user. The vulnerability here is Insecure Token Generation.</p>

<h3 id="challenge-6"><a href="https://twitter.com/SonarSource/status/1335614981224738816">Challenge 6</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">org</span><span class="p">.</span><span class="n">example</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">ServletException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">http</span><span class="p">.*;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.*;</span>
<span class="k">public</span> <span class="n">class</span> <span class="n">IndexServlet</span> <span class="n">extends</span> <span class="n">HttpServlet</span> <span class="p">{</span>
    <span class="n">private</span> <span class="k">String</span> <span class="n">referer</span><span class="p">;</span>
    <span class="n">private</span> <span class="n">ExportIcalManager</span> <span class="n">exportManager</span><span class="p">;</span>
    <span class="n">private</span> <span class="n">void</span> <span class="n">exportIcal</span><span class="p">(</span><span class="n">HttpServletResponse</span> <span class="n">res</span><span class="p">,</span> <span class="k">String</span> <span class="n">sessionId</span><span class="p">)</span> 
            <span class="n">throws</span> <span class="n">ServletException</span><span class="p">,</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">res</span><span class="p">.</span><span class="n">addHeader</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin"</span><span class="p">,</span> <span class="n">referer</span><span class="p">);</span>
        <span class="n">res</span><span class="p">.</span><span class="n">setContentType</span><span class="p">(</span><span class="s2">"text/plain"</span><span class="p">);</span>
        <span class="n">ExportIcalManager</span> <span class="n">exportManager</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ExportIcalManager</span><span class="p">(</span><span class="n">sessionId</span><span class="p">);</span>
        <span class="k">String</span> <span class="n">filePath</span> <span class="p">=</span> <span class="n">exportManager</span><span class="p">.</span><span class="n">exportIcalAgendaForSynchro</span><span class="p">();</span>
        <span class="n">OutputStream</span> <span class="n">os</span> <span class="p">=</span> <span class="n">res</span><span class="p">.</span><span class="n">getOutputStream</span><span class="p">();</span>
        <span class="n">FileInputStream</span> <span class="n">fs</span> <span class="p">=</span> <span class="n">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
        <span class="n">int</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(((</span><span class="n">i</span> <span class="p">=</span> <span class="n">fs</span><span class="p">.</span><span class="nb">read</span><span class="p">())</span> <span class="c1">!= -1)) { os.write(i); }
</span>        <span class="n">os</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">protected</span> <span class="n">void</span> <span class="n">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">HttpServletResponse</span> <span class="n">res</span><span class="p">)</span> 
            <span class="n">throws</span> <span class="n">ServletException</span><span class="p">,</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="p">=</span> <span class="n">req</span><span class="p">.</span><span class="n">getSession</span><span class="p">();</span>
        <span class="n">referer</span> <span class="p">=</span> <span class="n">req</span><span class="p">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s2">"referer"</span><span class="p">);</span>
        <span class="n">exportIcal</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">.</span><span class="n">getRequestedSessionId</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>This vulnerability the above code is exposed to is Misconfigured Cross Origin Resource Sharing (Cors). The referer header from a user‚Äôs request is used to set the Access-Control-Allow-Origin header. An attacker could spoof this header to provide a wildcard *, or modify this through a redirect from an attacker site to allow cross origin communication.</p>

<h3 id="challenge-7"><a href="https://twitter.com/SonarSource/status/1335614981224738816">Challenge 7</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">Upload</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$detect_mime</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$type_regex</span> <span class="o">=</span> <span class="s1">'/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/'</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">do_upload</span><span class="p">(</span><span class="nv">$field</span> <span class="o">=</span> <span class="s1">'userfile'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="nv">$field</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file_size</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'size'</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">_file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'finfo_file'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$finfo</span> <span class="o">=</span> <span class="o">@</span><span class="nb">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_MIME</span><span class="p">);</span>
            <span class="nv">$mime</span> <span class="o">=</span> <span class="o">@</span><span class="nb">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type_regex</span><span class="p">,</span> <span class="nv">$mime</span><span class="p">,</span> <span class="nv">$match</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file_type</span> <span class="o">=</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nv">$cmd</span> <span class="o">=</span> <span class="s1">'file --brief --mime '</span><span class="o">.</span><span class="nv">$file</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="o">.</span><span class="s1">' 2&gt;&amp;1'</span><span class="p">;</span>
        <span class="nb">exec</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">,</span> <span class="nv">$mime</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nb">preg_match</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type_regex</span><span class="p">,</span> <span class="nv">$mime</span><span class="p">,</span> <span class="nv">$match</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file_type</span> <span class="o">=</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$upload</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Upload</span><span class="p">();</span>
<span class="nv">$upload</span><span class="o">-&gt;</span><span class="na">do_upload</span><span class="p">();</span>
</code></pre></div></div>
<p>The do_upload function takes a user provided file (i assume) and the file_mime_type function is called to open this file. The name of this file is taken by the $file[‚Äòname‚Äô] object and is provided as part to the exec ($cmd = ‚Äòfile ‚Äìbrief ‚Äìmime ‚Äò.$file[‚Äòname‚Äô].‚Äô 2&gt;&amp;1‚Äô;) function. The vulnerability here is a Command Injection.</p>

<h3 id="challenge-8"><a href="https://twitter.com/SonarSource/status/1336352473871769603">Challenge 8</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using Microsoft.AspNetCore.Html;
using Microsoft.AspNetCore.Mvc;
using System.Text.Encodings.Web;
using System;
using System.Threading;
using System.Threading.Tasks;
namespace Core31Demo.Controllers
{
    public class HomeController : Controller {        
        [HttpGet]
        public async Task&lt;IActionResult&gt; Logout(string logoutId) {
            ViewBag.Logout = "Please confirm logout &amp;#8230;";
            if (User.Identity.IsAuthenticated == false) {
                return await Logout(new LogoutViewModel { LogoutId = logoutId });
            }
            return View("ConfirmLogout");
        }
        [HttpPost][ValidateAntiForgeryToken]
        public async Task&lt;IActionResult&gt; Logout(LogoutViewModel model) {
            await PerformSignOutAsync(model);
            ViewData["Logout"] = model.LogoutId;
            return View("Logout");
        }
        
        static async Task PerformSignOutAsync(LogoutViewModel model) {
            // sign out logic
            // throw new NotImplementedException();
        }
    }
    
    public class LogoutViewModel {
         public string LogoutId; 
    }
}


// Views/Home/Logout.cshtml

&lt;div class="page-header"&gt;
    &lt;h1&gt;@Html.Raw(@ViewBag.Logout)&lt;/h1&gt;&lt;/div&gt;
&lt;div class="logout-back"&gt;&lt;a asp-controller="Home" 
     asp-action="Login" asp-route-id="@ViewData["Logout"]"&gt;back&lt;/a&gt;
&lt;/div&gt;

</code></pre></div></div>

<p>A Cross-site Scripting (XSS) issue exists in the above code. User input is taken as the logoutId parameter ( through HttpGet). A new LogoutViewModel instance is created with the logoutId parameter: Logout(new LogoutViewModel { LogoutId = logoutId });. This is then given to the Task method which bind its to the @ViewBag.Logout model attribtue. The method Html.Raw() returns an IHtmlString with any HTML encoding. As such, XSS is possible.</p>

<h3 id="challenge-9"><a href="https://twitter.com/SonarSource/status/1336702146276888577">Challenge 9</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from __future__ import unicode_literals
import os
import shutil
import tempfile
import traceback
import zipfile
from django import forms
from django.http.response import HttpResponseRedirect
from django.utils.translation import ugettext_lazy as _
from django.views.generic import FormView
from django.views.decorators.csrf import csrf_exempt
class AddonUploadView(FormView):
    form_class = forms.Form
    template_name = "package/addon/upload.jinja"
    def get_addon_path(self):
        filename = os.path.basename(self.request.GET.get("my_file"))
        tmp_token = self.request.GET.get('my_token')
        path = os.path.join(tempfile.gettempdir(), tmp_token, filename)
        if not os.path.isfile(path):
            raise ValueError("Error! File not found.")
        if hasattr(os, "geteuid") and os.stat(path).st_uid != os.geteuid():
            raise ValueError("Error! File not owned by current user.")
        return path
    @csrf_exempt
    def form_valid(self, form):
        try:
            installer.install_package(self.get_addon_path())
            response["success"] = True
        except Exception:
            os.unlink(self.get_addon_path())
            response["success"] = False
        return self.render_to_response(response)
</code></pre></div></div>

<p>Three issues are described in the above code:</p>

<ul>
  <li>Cross Site Request Forgery - @csrf_exempt in Django removes Cross Site Request Forgery protection allowing the request to be forged by an attacker.</li>
  <li>Path Traversal - The path generated by the AddonUploadView function is user tainted.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        filename = os.path.basename(self.request.GET.get("my_file"))
        tmp_token = self.request.GET.get('my_token')
        path = os.path.join(tempfile.gettempdir(), tmp_token, filename)
</code></pre></div></div>

<p>This is then given to the os.stat(path) function which will execute the file provided by the user tainted path allowing execution of a user controlled file. This same also exists in os.unlink(self.get_addon_path()) where a path traversal can lead to arbritary file delete.</p>

<h3 id="challenge-10"><a href="https://twitter.com/SonarSource/status/1337064532355633152">Challenge 10</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import javax.servlet.*;
import javax.servlet.annotation.WebServlet;
import java.io.*;
import java.util.Enumeration;
import java.util.HashSet;
import java.util.Set;
import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;
import org.apache.commons.io.FileUtils;
import org.apache.commons.io.IOUtils;
@WebServlet(value="/unzip", name="ZipUtils")
class ZipUtils extends GenericServlet {
    private static final String BASE_DIR = "projects";
    @Override
    public void service(ServletRequest req, ServletResponse res) throws IOException {
        File zipFile = new File(BASE_DIR, req.getParameter("file"));
        if (zipFile.getCanonicalPath().startsWith(BASE_DIR)) {
            File indir = new File("/tmp/local/my_jars");
            unjar(zipFile, indir);
        }
    }
    private File[] unjar(File uploadFile, File inDir) throws IOException {
        String uploadFileName = inDir + File.separator + uploadFile.getName();
        ZipFile uploadZipFile = new ZipFile(uploadFile);
        Set&lt;File&gt; files = new HashSet&lt;File&gt;();
        Enumeration entries = uploadZipFile.entries();
        // unpack uploaded zip file
        while (entries.hasMoreElements()) {
            ZipEntry entry = (ZipEntry) entries.nextElement();
            File fe = new File(uploadFileName, entry.getName());
            if (entry.isDirectory()) {
                fe.mkdirs();
            } else {
                if (fe.getParentFile() != null 
                &amp;&amp; !fe.getParentFile().exists()) {
                    fe.getParentFile().mkdirs();
                }
                files.add(fe);
                IOUtils.copy(uploadZipFile.getInputStream(entry), 
                    new BufferedOutputStream(new FileOutputStream(fe)));
            }
        }
        uploadZipFile.close();
        return files.toArray(new File[files.size()]);
    }
}

</code></pre></div></div>

<p>The above code is vulnerable to Zip Path Traversal. User input (source) is entering via uploadZipFile.entries() method (Map.Entry). The code iterates through this Map and the getInputStream method is used to fetch the file and IOUtils.copy is used to copy bytes from an InputStream to chars on a Writer.</p>

<p>As such, you can create a ZIP archive containing an archive path such as ......\newfile and this file will be written outside the destination directory. This could be abused to overwrite files within the system.</p>

<h3 id="challenge-11"><a href="https://twitter.com/SonarSource/status/1337411824627552257">Challenge 11</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nn">Illuminate\Routing\Controller</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">Illuminate\Http\Response</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">Illuminate\Support\Facades\Request</span><span class="p">;</span>
<span class="kd">class</span> <span class="nc">Authenticate</span><span class="p">{</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">getEmail</span><span class="p">(</span><span class="nv">$email_field</span><span class="p">,</span> <span class="nv">$user_data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$email_field</span> <span class="k">as</span> <span class="nv">$field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$user_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nv">$field</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$user_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nv">$field</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findUsername</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$envvar</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">settings</span><span class="p">[</span><span class="s1">'fields'</span><span class="p">][</span><span class="s1">'envvar'</span><span class="p">];</span>
        <span class="nv">$ldapdn</span> <span class="o">=</span> <span class="nx">Config</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'WebApp.ldapDN'</span><span class="p">);</span>
        <span class="nv">$ldapSearchFilter</span> <span class="o">=</span> <span class="nx">Config</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'WebApp.ldapSearchFilter'</span><span class="p">);</span>
        <span class="nv">$ldapEmailField</span> <span class="o">=</span> <span class="nx">Config</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'WebApp.ldapEmailField'</span><span class="p">);</span>
        <span class="nv">$ldapconn</span> <span class="o">=</span> <span class="nb">ldap_connect</span><span class="p">(</span><span class="nx">Config</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'WebApp.ldapServer'</span><span class="p">))</span> 
            <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">'LDAP server connection failed'</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$ldapbind</span> <span class="o">=</span> <span class="nb">ldap_bind</span><span class="p">(</span><span class="nv">$ldapconn</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">die</span><span class="p">(</span><span class="s2">"LDAP bind failed"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$ldapSearchFilter</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$filter</span> <span class="o">=</span> <span class="s1">'(&amp;'</span> <span class="o">.</span> <span class="nv">$ldapSearchFilter</span> <span class="o">.</span> <span class="s1">'('</span> <span class="o">.</span>
            <span class="nx">Config</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'WebApp.ldapSearchAttribut'</span><span class="p">)</span> <span class="o">.</span> <span class="s1">'='</span> <span class="o">.</span>
            <span class="nx">Request</span><span class="o">::</span><span class="na">input</span><span class="p">(</span><span class="nv">$envvar</span><span class="p">)</span> <span class="o">.</span> <span class="s1">'))'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$getLdapUserInfo</span> <span class="o">=</span> <span class="nx">Config</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'WebApp.ldapFilter'</span><span class="p">);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">ldap_search</span><span class="p">(</span><span class="nv">$ldapconn</span><span class="p">,</span> <span class="nv">$ldapdn</span><span class="p">,</span> <span class="nv">$filter</span><span class="p">,</span> <span class="nv">$getLdapUserInfo</span><span class="p">)</span>
            <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">"LDAP Error: "</span> <span class="o">.</span> <span class="nb">ldap_error</span><span class="p">(</span><span class="nv">$ldapconn</span><span class="p">));</span>
        <span class="nv">$ldapUserData</span> <span class="o">=</span> <span class="nb">ldap_get_entries</span><span class="p">(</span><span class="nv">$ldapconn</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$ldapEmailField</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$ldapUserData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'mail'</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$ldapUserData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'mail'</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$ldapEmailField</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEmail</span><span class="p">(</span><span class="nv">$ldapEmailField</span><span class="p">,</span> <span class="nv">$ldapUserData</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">die</span><span class="p">(</span><span class="s2">"User not found in LDAP"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nb">ldap_close</span><span class="p">(</span><span class="nv">$ldapconn</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$username</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>User concentated data is inserted to the ldap_search function resulting in LDAP Injection: ldap_search($ldapconn, $ldapdn, $filter, $getLdapUserInfo) An ldap query is created with ldapSearchFilter and $envvar. $envvar can be user controlled data, and as such LDAP Injection is possible.</p>

<h3 id="challenge-12"><a href="https://twitter.com/SonarSource/status/1337789307386359812">Challenge 12</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using System;
using System.Collections;
using System.Globalization;
using System.Text.RegularExpressions;
using Microsoft.AspNetCore.Mvc;
using System.Linq;
namespace core_api.Controllers
{
    public class BlogPost {
        public DateTime ReleaseDate { get; set; }
        public string Content { get; set; }
    }
    public class BlogController : Controller
    {
        ArrayList Posts = new ArrayList();
        string Keyword = "[highlight]";
        
        public void init() {
            Posts.Add(new BlogPost{ReleaseDate = new DateTime(2009, 8, 1, 0, 0, 0), Content="[highlight]"});
        }
       
        [Route("api/search")]
        [HttpGet]
        public ArrayList search(string search, string since) {
            DateTime.TryParseExact(since, "MM-dd-yy", null,
                DateTimeStyles.None, out var parsedDate);
            var blogposts = from BlogPost blog in Posts
                where DateTime.Compare(blog.ReleaseDate, parsedDate) &gt; 0
                select blog.Content;
            ArrayList result = new ArrayList();
            foreach (var content in blogposts) {
                String tmp = content.Replace(Keyword, search);
                Regex rx = new Regex(search);
                Match match = rx.Match(tmp);
                if(match.Success) {
                    result.Add(match.Value);
                }
            }
            return result;
        }
    }
}
</code></pre></div></div>

<p>A Reject Injection/ReDoS vulnerability exists in the above code. The search argument is provided by user input. This is then provided to the Regex constructor and the user provided input is used for the regex match. An attacker could provide a large regex which could lead to backtracking when eveluating with Regex.</p>

<h3 id="challenge-13"><a href="https://twitter.com/SonarSource/status/1338151696439107584">Challenge 13</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
import requests
import errno
from django.conf import settings
class Sitemap():
    domain = "sonarsource.com"
    def __init__(self, filename="sitemap.xml"):
	self.url = "http://" + self.domain
        if not self.url.endswith('/'):
            self.url += '/'
        self.url += filename
        self.destination = os.path.join(settings.STATIC_ROOT, filename)
	
    def fetch(self, dataset=None):
        headers = {'User-Agent': 'Mozilla/5.0 Chrome/50.2661 Safari/537.36'}
        try:
            response = requests.get(self.url, timeout=30, headers=headers)
        except requests.exceptions.SSLError:
            response = requests.get(self.url, verify=False, headers=headers)
        finally:
            pass
        with open(self.destination, 'wb') as f:
            f.write(response.content)

</code></pre></div></div>
<p>Two issues exist in the above code:</p>

<ul>
  <li>http:// protocol URI is used as the URL that will be used by requests.get. Usage of Plain text protocols** are considered bad practice.</li>
  <li>The verify=False option is set for requests.get. This is disables server certificate validation and is considered to be Insecure Configuration.</li>
</ul>

<h3 id="challenge-14"><a href="https://twitter.com/SonarSource/status/1338514090755440641">Challenge 14</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.util.Properties;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
public class IndexServlet {
    private final ServletContext context;
    private final String templateFile = "/org/java/repository.xml";
        
    public IndexServlet(ServletContext context) {
        this.context = context;
    }
    
    public void installRepository(HttpServletRequest req)
            throws ServletException, IOException {
        String mode = req.getParameter("mode");
        String repHome = req.getParameter("repository_home");
        if (repHome != null &amp;&amp; mode != null &amp;&amp; "new".equals(mode)) {
            installConfig(new File(repHome));
        }
    }
    private void installConfig(File dest) throws IOException {
        InputStream in = context.getResourceAsStream(templateFile);
        OutputStream out = new FileOutputStream(dest);
        byte[] buffer = new byte[8192]; int read;
        while ((read = in.read(buffer)) &gt;= 0) {
            out.write(buffer, 0, read);
        }
        in.close();
        out.close();
    }
}

</code></pre></div></div>

<p>Tainted source is flowing from req.getParameter(‚Äúrepository_home‚Äù);, this is the provided to the new File constructor and flows to the installConfig method. The user input then flows to the FileOutputStream(dest) method which creates a new file in the give file path, resulting in Arbritary File Write.</p>

<h3 id="challenge-15"><a href="https://twitter.com/SonarSource/status/1338868922225856516">Challenge 15</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">'restore'</span> <span class="o">==</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'action'</span><span class="p">])</span> <span class="p">{</span>
    <span class="nv">$upload</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">];</span>
    <span class="nv">$upload_tmp</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">];</span>
    <span class="nv">$upload_name</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">][</span><span class="s1">'name'</span><span class="p">];</span>
    <span class="nv">$upload_error</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">][</span><span class="s1">'error'</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$upload_error</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$upload_error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="nx">UPLOAD_ERR_INI_SIZE</span><span class="o">:</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">"Error %s"</span><span class="p">,</span> <span class="nv">$upload_error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$upload_name</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$upload_name</span> <span class="o">=</span> <span class="nb">filter_input</span><span class="p">(</span><span class="nx">INPUT_POST</span><span class="p">,</span><span class="s1">'file'</span><span class="p">,</span><span class="nx">FILTER_SANITIZE_STRING</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$ret_val</span> <span class="o">=</span> <span class="nx">do_upload</span><span class="p">(</span><span class="nv">$upload_tmp</span><span class="p">,</span> <span class="nv">$upload_name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s1">'&lt;p&gt;&lt;b&gt;restore from '</span> <span class="o">.</span> <span class="nv">$upload_name</span> <span class="o">.</span> <span class="s1">'&lt;/b&gt;'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Multiple issues exist in the above code:</p>

<ul>
  <li>An Insufficient Validation issue exists where a file with any extension can be uploaded</li>
  <li>Two Cross-site Scripting (XSS) issues exist. One within the sprintf sink where $upload_error is reflected back a a user. Another XSS exists where $upload_name is reflected back to a user in the echo statement.</li>
</ul>

<h3 id="challenge-16"><a href="https://twitter.com/SonarSource/status/1339226778477285376">Challenge 16</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using System;
using System.IO;
using System.Xml;
using System.Xml.Serialization;
using Microsoft.AspNetCore.Mvc;
[Serializable]
public class ExchangeData {
}
namespace core_api.Controllers {
    public class ShareDataController : Controller {
        [Route("import/exchange")] 
        [HttpPost]
        public string ImportExchangeData(string content) {
            var xmlDoc = new XmlDocument { XmlResolver = null };
            xmlDoc.LoadXml(content); 
            var rootItem = (XmlElement)xmlDoc.SelectSingleNode("root");
            var dataType = Type.GetType(rootItem.GetAttribute("data"));
            var reader = new StringReader(rootItem.InnerXml);
            ExchangeData exchange = Import(dataType, reader);
            return exchange.ToString();
        }
        private static ExchangeData Import(Type t, StringReader r) {
            XmlSerializer serializer = new XmlSerializer(t);
            XmlTextReader textReader = new XmlTextReader(r);
            ExchangeData data = (ExchangeData)serializer.Deserialize(textReader);
            return data;
        }
    }
}
</code></pre></div></div>

<p>An Unsafe Deserialization vulnerability exists in the above code. XmlSerializer is used to deserialize user object provided by the content argument. For XmlSerializer serializer, the expected type should not come from user-controlled input. In the above code, the expected data type is coming from rootItem.GetAttribute(‚Äúdata‚Äù).</p>

<h3 id="challenge-17"><a href="https://twitter.com/SonarSource/status/1339586153545150464">Challenge 17</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import copy
import io
from http import HTTPStatus
from zipfile import ZipFile
from flask import Blueprint, current_app, jsonify, request, send_file
@FIXTURE_BLUEPRINT.route('/api/export/&lt;business_id&gt;', methods=['GET'])
def get(business_id, table=None):
    con = current_app.config.get('DB_CONNECTION', None)
    if not con:
        current_app.logger.error('Database connection failure')
        return jsonify({'message': 'Database connection error'})
    cur = con.cursor()
    bid = _get_business_id(cur=cur, business_id=business_id)
    if not bid:
        current_app.logger.error(f'{business_id} not found')
        return jsonify({'message': f'Could not find {business_id}.'})
    try:
        tmp_file = _create_export(cur=cur, table=table, bid=bid)
        if not tmp_file:
            return jsonify({'message': f'Failed to create export for {bid}'})
        current_app.logger.error(f'DELETE: {tmp_file}')
        return send_file(attachment_filename=tmp_file, as_attachment=True)
    except Exception as err:
        current_app.logger.error(f'Failed to export')
        con.reset()
        return jsonify({'message': 'Failed to export data.'})
</code></pre></div></div>

<p>A Log Injection vulnerability exists where data source coming from business_id is validated and if it doesn‚Äôt exist, this is logged into the current_app.logger.error method directly. An attacker could inject CRLF characters (%0D%0A) and adding additional log entries.</p>

<h3 id="challenge-18"><a href="https://twitter.com/SonarSource/status/1339956086237929474">Challenge 18</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">org</span><span class="p">.</span><span class="n">example</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">ServletException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">http</span><span class="p">.*;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">FileInputStream</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">InputStream</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">zip</span><span class="p">.</span><span class="n">ZipEntry</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">zip</span><span class="p">.</span><span class="n">ZipInputStream</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">jdom2</span><span class="p">.</span><span class="n">Content</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">jdom2</span><span class="p">.</span><span class="n">Document</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">jdom2</span><span class="p">.</span><span class="n">JDOMException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">jdom2</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">SAXBuilder</span><span class="p">;</span>
<span class="k">public</span> <span class="n">class</span> <span class="n">IndexServlet</span> <span class="n">extends</span> <span class="n">HttpServlet</span> <span class="p">{</span>
    <span class="n">private</span> <span class="k">String</span> <span class="n">extractContent</span><span class="p">()</span> <span class="n">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">JDOMException</span> <span class="p">{</span>
        <span class="n">File</span> <span class="n">uploadFile</span> <span class="p">=</span> <span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="s2">"/users/upload/document.odt"</span><span class="p">);</span>
        <span class="n">InputStream</span> <span class="k">in</span> <span class="p">=</span> <span class="n">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">uploadFile</span><span class="p">);</span>
        <span class="n">final</span> <span class="n">ZipInputStream</span> <span class="n">zis</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ZipInputStream</span><span class="p">(</span><span class="k">in</span><span class="p">);</span>
        <span class="n">ZipEntry</span> <span class="n">entry</span><span class="p">;</span>
        <span class="k">List</span><span class="p">&lt;</span><span class="n">Content</span><span class="p">&gt;</span> <span class="n">content</span> <span class="p">=</span> <span class="n">null</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">entry</span> <span class="p">=</span> <span class="n">zis</span><span class="p">.</span><span class="n">getNextEntry</span><span class="p">())</span> <span class="c1">!= null) {
</span>            <span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">equals</span><span class="p">(</span><span class="s2">"content.xml"</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">final</span> <span class="n">SAXBuilder</span> <span class="n">sax</span> <span class="p">=</span> <span class="n">new</span> <span class="n">org</span><span class="p">.</span><span class="n">jdom2</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">SAXBuilder</span><span class="p">();</span>
                <span class="n">Document</span> <span class="n">doc</span> <span class="p">=</span> <span class="n">sax</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">zis</span><span class="p">);</span>
                <span class="n">content</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">getContent</span><span class="p">();</span>
                <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="n">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">content</span> <span class="c1">!= null) {
</span>                    <span class="n">for</span> <span class="p">(</span><span class="n">Content</span> <span class="n">item</span> <span class="p">:</span> <span class="n">content</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">sb</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">getValue</span><span class="p">());</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">zis</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
                <span class="n">return</span> <span class="n">sb</span><span class="p">.</span><span class="n">toString</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">return</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">protected</span> <span class="n">void</span> <span class="n">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">HttpServletResponse</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">throws</span> <span class="n">ServletException</span><span class="p">,</span> <span class="n">IOException</span>
    <span class="p">{</span>
        <span class="n">try</span> <span class="p">{</span>
            <span class="n">extractContent</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>org.jdom2.input.SAXBuilder is used to parse an .odt file. An .odt file contains XML files will be parsed by SAXBuilder, content.xml in this example. In the above example, SAXBuilder is set without builder.setFeature(‚Äúhttp://apache.org/xml/features/disallow-doctype-decl‚Äù,true); which provides an attack vector for XML External Entity (XXE). An attacker could modify the content.xml to have external entities.</p>

<h3 id="challenge-19"><a href="https://twitter.com/SonarSource/status/1340326027206209539">Challenge 19</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">Illuminate\Support\Facades\Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">Illuminate\Support\Facades\Response</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">Illuminate\Http\RedirectResponse</span><span class="p">;</span>
<span class="kd">class</span> <span class="nc">LessonsController6</span> <span class="k">extends</span> <span class="nx">ApiController</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">()</span><span class="o">:</span> <span class="nx">RedirectResponse</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="na">cookie</span><span class="p">(</span><span class="s1">'site'</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nv">$site_id</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">cookie</span><span class="p">(</span><span class="s1">'site'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="na">getHost</span><span class="p">()))</span> <span class="p">{</span>
            <span class="nv">$site_id</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">getHost</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$site_id</span> <span class="o">=</span> <span class="s1">'default'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$site_id</span><span class="p">)</span> <span class="o">||</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/[^A-Za-z0-9.-_]/'</span><span class="p">,</span> <span class="nv">$site_id</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">'Invalid ID '</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$site_id</span><span class="p">,</span> <span class="nx">ENT_NOQUOTES</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">require_once</span> <span class="s2">"sites/</span><span class="nv">$site_id</span><span class="s2">.php"</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$config</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">'login'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'site'</span> <span class="o">=&gt;</span> <span class="nv">$site_id</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">'setup'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'site'</span> <span class="o">=&gt;</span> <span class="nv">$site_id</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>A Local File Inclusion exists in the above code. It is possible to set an arbritary path through a host header (Request::getHost() or a Cookie Request::cookie(‚Äòsite‚Äô), The regex used by the code ([^A-Za-z0-9.-_]) does not validate ../../ and this $siteid is provided to require_once ‚Äúsites/$site_id.php‚Äù;. The .php extension can be bypassed using a null byte (%00).</p>

<h3 id="challenge-20"><a href="https://twitter.com/SonarSource/status/1340688412450414592">Challenge 20</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using System;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Cryptography;
using Microsoft.AspNetCore.Mvc;
using Microsoft.IdentityModel.Tokens;
using Org.BouncyCastle.Crypto;
using Org.BouncyCastle.Crypto.Parameters;
using Org.BouncyCastle.Security;
namespace core_api.Controllers
{
    public class ApiController : Controller
    {
        private readonly string publicKey;        
	private readonly string authTokenIssuer;
        
        public ApiController(string publicKey, string authTokenIssuer)     
        {
            this.publicKey = publicKey;
            this.authTokenIssuer = authTokenIssuer;
        }
        
        private String ExportPublicKey(RSACryptoServiceProvider rsa)
        {
            throw new NotImplementedException();
        }
        private RSACryptoServiceProvider ImportKeyParameters(string publicKey)
        {
            throw new NotImplementedException();
        }
	    
        public JwtSecurityToken ValidateToken(string token) {           
            byte[] keyBytes = Convert.FromBase64String(publicKey);
            var keyParams = (RsaKeyParameters)PublicKeyFactory.CreateKey(keyBytes);
            var rsaParams = new RSAParameters {
                Modulus = keyParams.Modulus.ToByteArrayUnsigned(),
                Exponent = keyParams.Exponent.ToByteArrayUnsigned() 
            };
            var rsa = new RSACryptoServiceProvider();
            rsa.ImportParameters(rsaParams);
            rsa.KeySize = 4096;
            var validationParameters = new TokenValidationParameters {
                RequireExpirationTime = true,
                RequireSignedTokens = true,
                ValidIssuer = authTokenIssuer,
                ValidateIssuer = true,
                ValidateLifetime = true,
                IssuerSigningKey = new RsaSecurityKey(rsa)
            };
            var handler = new JwtSecurityTokenHandler();
            handler.ValidateToken(token, validationParameters, out SecurityToken validatedSecurityToken);
            var validatedJwt = validatedSecurityToken as JwtSecurityToken;
            return validatedJwt;
        }       
    }
}

</code></pre></div></div>
<p>The above code is an example of Insecure Cryptography. RSACryptoServiceProvider constructor by default sets the key size to be 1024. The rsa.KeySize = 4096; assingment does not change the keysize according to the SonarSource expected solution.</p>

<h3 id="challenge-21"><a href="https://twitter.com/SonarSource/status/1341035697734561792">Challenge 21</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
import tempfile
'''
Open the pdf reader on windows for the report file
'''
def open_report(report_class, _system="Windows", *args, **kwargs):
    rv = PrintReportEvent.emit(report_class, *args, **kwargs)
    if rv:
        return rv
    filters = kwargs.pop('filters', None)
    if filters:
        kwargs = describe_search_filters_for_reports(filters, **kwargs)
    tmp = tempfile.mktemp(suffix='.pdf', prefix='stoqlib-reporting')
    report = report_class(tmp, *args, **kwargs)
    report.filename = tmp
    if _system == "Windows":
        report.save()
        log.info("Executing PDF reader with %r" % (report.filename, ))
        os.startfile(report.filename)
        return
    if isinstance(report, HTMLReport):
        op = PrintOperationWEasyPrint(report)
        op.set_threaded()
    else:
        op = PrintOperationPoppler(report)
    rv = op.run()
    return rv
</code></pre></div></div>

<p>The issue here arises from the tempfile.mktemp function being used which allows for potential Race Condition. An attacker could create a file of his choice before the mktemp is triggered by an user. The following stackoverflow explains this vulnerability: <a href="https://stackoverflow.com/questions/37093444/using-python-tempfiles-permanently">Stackoverflow - using-python-tempfiles-permanently</a></p>

<h3 id="challenge-22"><a href="https://twitter.com/SonarSource/status/1341035697734561792">Challenge 22</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">restservice</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">beans</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Autowired</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">stereotype</span><span class="p">.</span><span class="n">Controller</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">ModelAttribute</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">RequestMapping</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">RequestMethod</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">ModelAndView</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">hibernate</span><span class="p">.</span><span class="n">criterion</span><span class="p">.</span><span class="n">Restrictions</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">hibernate</span><span class="p">.</span><span class="n">criterion</span><span class="p">.</span><span class="n">Criterion</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">hibernate</span><span class="p">.</span><span class="n">type</span><span class="p">.</span><span class="n">StringType</span><span class="p">;</span>
<span class="p">@</span><span class="n">Controller</span>
<span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="s2">"/nodeList.htm"</span><span class="p">)</span>
<span class="k">public</span> <span class="n">class</span> <span class="n">NodeListController</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">NodeListModel</span> <span class="n">createNodeList</span><span class="p">(</span><span class="n">NodeListCommand</span> <span class="nf">command</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NodeCriteria</span> <span class="n">criteria</span> <span class="p">=</span> <span class="n">new</span> <span class="n">NodeCriteria</span><span class="p">(</span><span class="n">Node</span><span class="p">.</span><span class="n">class</span><span class="p">,</span> <span class="s2">"node"</span><span class="p">);</span>
        <span class="n">addNodeCriteria</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nf">command</span><span class="p">.</span><span class="n">getNodeParm</span><span class="p">(),</span> <span class="nf">command</span><span class="p">.</span><span class="n">getNodeParmValue</span><span class="p">());</span>
        <span class="n">return</span> <span class="n">createModel</span><span class="p">(</span><span class="nf">command</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">method</span><span class="p">={</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">POST</span> <span class="p">})</span>
    <span class="k">public</span> <span class="n">ModelAndView</span> <span class="n">handle</span><span class="p">(@</span><span class="n">ModelAttribute</span><span class="p">(</span><span class="s2">"command"</span><span class="p">)</span> <span class="n">NodeListCommand</span> <span class="nf">command</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NodeListModel</span> <span class="k">model</span> <span class="p">=</span> <span class="n">createNodeList</span><span class="p">(</span><span class="nf">command</span><span class="p">);</span>
        <span class="n">ModelAndView</span> <span class="n">modelAndView</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ModelAndView</span><span class="p">(</span><span class="s2">"nodeList"</span><span class="p">,</span> <span class="s2">"model"</span><span class="p">,</span> <span class="k">model</span><span class="p">);</span>
        <span class="n">return</span> <span class="n">modelAndView</span><span class="p">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">"command"</span><span class="p">,</span> <span class="nf">command</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">private</span> <span class="n">static</span> <span class="n">void</span> <span class="n">addNodeCriteria</span><span class="p">(</span><span class="n">NodeCriteria</span> <span class="n">criteria</span><span class="p">,</span>
            <span class="k">String</span> <span class="n">nodeParm</span><span class="p">,</span> <span class="k">String</span> <span class="n">nodeParmValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">final</span> <span class="k">String</span> <span class="n">nodeParameterName</span> <span class="p">=</span> <span class="p">(</span><span class="s2">"snmp"</span> <span class="p">+</span> <span class="n">nodeParm</span><span class="p">).</span><span class="n">toLowerCase</span><span class="p">();</span>    
        <span class="n">criteria</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Restrictions</span><span class="p">.</span><span class="n">sqlRestriction</span><span class="p">(</span><span class="n">nodeParameterName</span> <span class="p">+</span> <span class="s2">" = ?)"</span><span class="p">,</span> 
            <span class="n">nodeParmValue</span><span class="p">,</span> <span class="n">new</span> <span class="n">StringType</span><span class="p">()));</span>       
        <span class="n">criteria</span><span class="p">.</span><span class="n">createAlias</span><span class="p">(</span><span class="n">nodeParm</span><span class="p">,</span> <span class="n">nodeParameterName</span><span class="p">);</span>    
    <span class="p">}</span>
    
    <span class="n">private</span> <span class="n">NodeListModel</span> <span class="n">createModel</span><span class="p">(</span><span class="n">NodeListCommand</span> <span class="nf">command</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">return</span> <span class="n">new</span> <span class="n">NodeListModel</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>A SQL Injection exists in the above code. Tainted data is flowing from source <code class="highlighter-rouge">@ModelAttribute("command") NodeListCommand</code> command. The command argument is then sent to the createNodeList method. The command then flows to the addNodeCriteria method. The nodeParm argument from the addNodeCriteria method is then concentated to the nodeParameterName variable: final String <code class="highlighter-rouge">nodeParameterName = ("snmp" + nodeParm).toLowerCase();</code>. This then added to the createAlias HQL sink via criteria.addresulting in SQL injection.</p>

<h3 id="challenge-23"><a href="https://twitter.com/SonarSource/status/1341035697734561792">Challenge 23</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="kd">class</span> <span class="nc">email_output_html</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">express</span><span class="p">(</span><span class="nv">$expression</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$expression</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'/env:([a-z0-9_]+)/i'</span><span class="p">,</span>
                <span class="s1">'/config:([a-z0-9_]+)(:(\S+))?/i'</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s2">"(isset(</span><span class="se">\$</span><span class="s2">this-&gt;env['</span><span class="se">\\</span><span class="s2">1']) ? </span><span class="se">\$</span><span class="s2">this-&gt;env['</span><span class="se">\\</span><span class="s2">1'] : null)"</span><span class="p">,</span>
                <span class="s2">"</span><span class="se">\$</span><span class="s2">this-&gt;config-&gt;get('</span><span class="se">\\</span><span class="s2">1', '</span><span class="se">\\</span><span class="s2">3')"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="nv">$expression</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="k">eval</span><span class="p">(</span><span class="s2">"return (</span><span class="nv">$expression</span><span class="s2">);"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">parse_template</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$attributes</span>  <span class="o">=</span> <span class="nx">html</span><span class="o">::</span><span class="na">parse_attrib_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'_mail_body'</span><span class="p">]);</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$attributes</span> <span class="k">as</span> <span class="nv">$attrib</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$attrib</span><span class="p">[</span><span class="s1">'express'</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$attrib</span><span class="p">[</span><span class="s1">'c'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">express</span><span class="p">(</span><span class="nv">$attrib</span><span class="p">[</span><span class="s1">'express'</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$attrib</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$attrib</span><span class="p">[</span><span class="s1">'command'</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$attrib</span><span class="p">[</span><span class="s1">'c'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">button</span><span class="p">(</span><span class="nv">$attrib</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="nc">html</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">parse_attrib_string</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>	
        <span class="nv">$attrib</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">'/\s*([-_a-z]+)=(["\'])??(?(2)([^\2]*)\2|(\S+?))/Ui'</span><span class="p">,</span> <span class="nv">$str</span><span class="p">,</span> <span class="nv">$regs</span><span class="p">,</span> <span class="nx">PREG_SET_ORDER</span><span class="p">);</span>
		
        <span class="k">if</span> <span class="p">(</span><span class="nv">$regs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$regs</span> <span class="k">as</span> <span class="nv">$attr</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$attrib</span><span class="p">[</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$attr</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">html_entity_decode</span><span class="p">(</span><span class="nv">$attr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$attr</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$attrib</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A Code Injection exists due to the usage of eval. User input is flowing from the parse_template function to the express function as follows: <code class="highlighter-rouge">express($attrib['express']</code> I wasn‚Äôt able to find a bypass for the regex used within the parse_template function; the SonarSource expected solution states that the following payload can be used: <code class="highlighter-rouge">/config:sonar:'.phpinfo().</code>‚Äô</p>

<h3 id="challenge-24"><a href="https://twitter.com/SonarSource/status/1342122866440101889">Challenge 24</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.IO;
using System.Diagnostics;
using System.Reflection;
namespace core_api
{
    public partial class Form1 : Form
    {
        const int MAX_PATH = 10;
        public Form1()
        {
            InitializeComponent();
        }
        private void btnInstallPackage_Click(object sender, EventArgs e) {
            InstallPackage(txtPackage.Text, CurrentProject.ProjectDirectory);
        }
        public static void InstallPackage(string packageId, string workingDir) {
            string dir = Path.Combine(workingDir, "nuget");
            dir = Path.Combine(dir, packageId).Substring(0, MAX_PATH);
            Directory.CreateDirectory(dir);
            Process nuget = new Process();
            nuget.StartInfo.FileName = Path.Combine(Tools.GetPath(), "nuget");
            nuget.StartInfo.Arguments = "install "+packageId+" -NonInteractive";
            nuget.StartInfo.CreateNoWindow = true;
            nuget.StartInfo.RedirectStandardOutput = true;
            nuget.StartInfo.RedirectStandardError = true;
            nuget.StartInfo.WorkingDirectory = dir;
            nuget.StartInfo.StandardOutputEncoding = System.Text.Encoding.UTF8;
            nuget.StartInfo.UseShellExecute = false;
            nuget.Start();
        }
    }
    class Tools
    {
        public static string GetPath()
        {
            return "D:\\test\\VisualNuget\\nuget";
        }
    }
    class CurrentProject
    {
        public static string ProjectDirectory = "D:\\test\\VisualNuget";
    }
}
</code></pre></div></div>
<p>The issue here arisies from the InstallPackage method taking a packageId parameter. This parameter is concentated into the arguments :nuget.StartInfo.Arguments = ‚Äúinstall ‚Äú+packageId+‚Äù -NonInteractive‚Äù;and is ran as part of the nuget command. It is not possible to conduct a Command Injection attack due to user input only ending up in nuget.StartInfo.Arguments but Argument Injection is possible and run the command with additional arguments that the binary wasn‚Äôt expecting.</p>

</article>





<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=Code+Security+Advent+Calendar+2020+Answers&url=http%3A%2F%2Flocalhost%3A4000%2Fweb-application-security%2F2020%2F12%2F28%2Fcode-security-advent-calendar-answers.html&via=snoopysecurity"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fweb-application-security%2F2020%2F12%2F28%2Fcode-security-advent-calendar-answers.html"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
</section>

	<section class="post-navigation">
		<span class="prev-post">
			
				<a href="/application-security/2020/09/02/02_writing_angularjs_semgrep_rules.html">
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
					</span>
					<span class="page-number">Writing AngularJS Security Semantic Rules using Semgrep</span>
				</a>
			
		</span>
		<span class="next-post">
			
				<a href="/web-application-security/2021/01/08/02_php_object_injection_exploitation-notes.html">
					<span class="page-number">PHP Object Injection Exploitation Notes</span>
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-right fa-stack-1x fa-inverse"></i>
					</span>
				</a>
			
		</span>
	</section>




</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">üíª | Blog</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	
	<li class="nav-link"><a href="/wallofsheep/">Wall Of Sheep</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:@snoopysecurity">
            <i class="fa fa-envelope-o"></i>
            <span class="username">@snoopysecurity</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://twitter.com/snoopysecurity" title="Follow me on Twitter">
              <i class="fa fa-twitter"></i>
              <span class="username">snoopysecurity</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://github.com/snoopysecurity" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">snoopysecurity</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://www.linkedin.com/pub/sam-sanoop/47/769/60a" title="Connect with me on LinkedIn">
              <i class="fa fa-linkedin"></i>
              <span class="username">Sam Sanoop</span>
            </a>
          </li>
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">Hack adventures while segfaulting through life
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
<script src="//unpkg.com/popper.js@1"></script>
<script src="//unpkg.com/tippy.js@5"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

	// Enable tooltips via Tippy.js
	if (Array.isArray(window.tooltips)) {
		window.tooltips.forEach(function(tooltip) {
			var selector = tooltip[0];
			var config = tooltip[1];
			tippy(selector, config);
		})
	}
});

</script>






  </body>

</html>
